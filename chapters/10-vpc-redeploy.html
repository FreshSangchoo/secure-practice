<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>이커머스를 VPC에 재배포 - AWS 기초 강의</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>

<header class="site-header">
  <div class="header-inner">
    <a href="../index.html" class="header-logo">
      <span class="aws-icon">AWS</span>
      <span>기초 강의</span>
    </a>
  </div>
</header>

<div class="page-layout">
  <nav class="sidebar">
    <ul class="sidebar-nav">
      <li><a href="#current-state">현재 상태 복습</a></li>
      <li><a href="#why-vpc">왜 VPC에 재배포?</a></li>
      <li><a href="#architecture">아키텍처 설계</a></li>
      <li><a href="#lab">실습</a></li>
    </ul>
  </nav>

  <main class="main-content">
    <div class="chapter-header">
      <span class="chapter-num">Chapter 10</span>
      <h1>이커머스를 VPC에 재배포</h1>
      <div class="objectives">
        <h3>학습 목표</h3>
        <ul>
          <li>기존 EC2 배포 방식의 보안 문제점을 이해한다</li>
          <li>퍼블릭/프라이빗 서브넷을 활용한 2-tier 아키텍처를 설계한다</li>
          <li>ShopEasy 이커머스 앱을 VPC 기반으로 재배포한다</li>
          <li>보안그룹 체이닝으로 서비스 간 통신을 제어한다</li>
        </ul>
      </div>
    </div>

    <!-- Section 1: 현재 상태 복습 -->
    <section class="content-section" id="current-state">
      <h2>현재 상태 복습</h2>

      <p>지금까지 우리는 ShopEasy 이커머스 앱을 EC2에 배포했습니다. 프론트엔드(React)와 API 서버(Node.js) 모두 퍼블릭 서브넷의 EC2 인스턴스에서 동작하고 있죠. 현재 구조를 정리해보겠습니다.</p>

      <div class="diagram">
        <div class="diagram-title">현재 배포 구조</div>
        <div class="diagram-row">
          <div class="diagram-box user"><div class="box-title">인터넷</div></div>
        </div>
        <div class="diagram-arrow down">↓</div>
        <div class="diagram-row">
          <div class="diagram-box compute">
            <div class="box-title">프론트엔드 EC2</div>
            <div class="box-sub">(퍼블릭 IP)<br>Nginx + React<br>포트: 80</div>
          </div>
          <div class="diagram-arrow">→ HTTP 요청 →</div>
          <div class="diagram-box compute">
            <div class="box-title">API 서버 EC2</div>
            <div class="box-sub">(퍼블릭 IP)<br>Node.js + SQLite<br>포트: 5000</div>
          </div>
        </div>
      </div>

      <h3>현재 구조의 문제점</h3>
      <ul>
        <li><strong>API 서버가 인터넷에 직접 노출</strong> - 누구나 API 서버의 퍼블릭 IP로 직접 접근 가능</li>
        <li><strong>보안그룹만으로 보호</strong> - 보안그룹 설정 실수 하나로 데이터베이스가 노출될 위험</li>
        <li><strong>네트워크 분리가 안 됨</strong> - 프론트엔드와 백엔드가 같은 네트워크 레벨에 존재</li>
        <li><strong>확장성 부족</strong> - 로드밸런서 없이 단일 서버로 운영</li>
      </ul>

      <div class="info-box analogy">
        <div class="info-box-title">비유로 이해하기: 가게 배치</div>
        <p>현재 상태는 마치 가게의 <strong>매장(프론트엔드)과 금고(API 서버+DB)</strong>가 모두 길가에 나와 있는 것과 같습니다. 누구나 금고까지 직접 걸어갈 수 있는 상태죠. 우리가 해야 할 일은 <strong>매장은 길가에 두되, 금고는 건물 안쪽</strong>으로 옮기는 것입니다.</p>
      </div>
    </section>

    <!-- Section 2: 왜 VPC에 재배포해야 하나? -->
    <section class="content-section" id="why-vpc">
      <h2>왜 VPC에 재배포해야 하나?</h2>

      <h3>보안 강화</h3>
      <p>API 서버를 프라이빗 서브넷에 배치하면, 인터넷에서 직접 접근이 <strong>물리적으로 불가능</strong>합니다. 보안그룹 설정을 실수하더라도, 프라이빗 서브넷에는 인터넷 게이트웨이로의 경로가 없기 때문에 외부에서 접근할 수 없습니다.</p>

      <div class="info-box concept">
        <div class="info-box-title">핵심 개념: 네트워크 분리 (Network Segmentation)</div>
        <p>네트워크를 역할별로 나누는 것은 보안의 기본 원칙입니다. 외부와 통신해야 하는 서버(웹 서버)는 퍼블릭 서브넷에, 내부에서만 동작하면 되는 서버(API, DB)는 프라이빗 서브넷에 배치합니다. 이를 <strong>2-tier 또는 3-tier 아키텍처</strong>라고 합니다.</p>
      </div>

      <h3>실무 표준 아키텍처</h3>
      <p>실무에서 거의 모든 웹 서비스는 이 구조를 따릅니다:</p>
      <table>
        <thead>
          <tr><th>계층</th><th>위치</th><th>역할</th><th>인터넷 접근</th></tr>
        </thead>
        <tbody>
          <tr><td>프론트엔드/웹 서버</td><td>퍼블릭 서브넷</td><td>사용자 요청 수신</td><td>가능 (인바운드/아웃바운드)</td></tr>
          <tr><td>API/애플리케이션 서버</td><td>프라이빗 서브넷</td><td>비즈니스 로직 처리</td><td>아웃바운드만 (NAT 통해)</td></tr>
          <tr><td>데이터베이스</td><td>프라이빗 서브넷</td><td>데이터 저장</td><td>불가</td></tr>
        </tbody>
      </table>

      <div class="info-box analogy">
        <div class="info-box-title">비유로 이해하기: 회사 건물</div>
        <p>회사 건물을 생각해보세요. <strong>1층 로비(퍼블릭 서브넷)</strong>에는 안내데스크(프론트엔드)가 있어서 방문객이 자유롭게 들어올 수 있습니다. 하지만 <strong>사무실(프라이빗 서브넷)</strong>에 들어가려면 출입카드가 필요하죠. 서버 룸(DB)은 더 안쪽에 있어서 특정 직원만 접근할 수 있습니다. 사무실 직원이 외부에 택배를 보내려면(인터넷 접근) 1층 우편실(NAT 게이트웨이)을 통해야 합니다.</p>
      </div>

      <h3>보안그룹 체이닝</h3>
      <p>VPC 구조에서는 <strong>보안그룹 체이닝</strong>이라는 강력한 보안 패턴을 사용할 수 있습니다. IP 주소 대신 보안그룹 ID를 참조하여 "이 보안그룹에 속한 인스턴스만 접근 허용"이라고 설정하는 것입니다.</p>

      <div class="info-box tip">
        <div class="info-box-title">보안그룹 체이닝의 장점</div>
        <p>IP 주소로 허용하면 서버가 바뀔 때마다 보안그룹을 수정해야 합니다. 하지만 보안그룹 ID로 참조하면, 해당 보안그룹에 새 서버를 추가하기만 하면 자동으로 접근이 허용됩니다. Auto Scaling으로 서버가 늘어날 때 특히 유용합니다.</p>
      </div>
    </section>

    <!-- Section 3: 아키텍처 설계 -->
    <section class="content-section" id="architecture">
      <h2>아키텍처 설계</h2>

      <p>우리가 구축할 아키텍처는 다음과 같습니다:</p>

      <div class="diagram">
        <div class="diagram-title">VPC 기반 2-tier 아키텍처</div>
        <div class="diagram-row">
          <div class="diagram-box user"><div class="box-title">인터넷</div></div>
        </div>
        <div class="diagram-arrow down">↓</div>
        <div class="diagram-row">
          <div class="diagram-box network"><div class="box-title">인터넷 게이트웨이</div></div>
        </div>
        <div class="diagram-arrow down">↓</div>
        <div class="diagram-group vpc">
          <div class="diagram-group-label">VPC (10.0.0.0/16)</div>
          <div class="diagram-group subnet-pub">
            <div class="diagram-group-label">퍼블릭 서브넷 (10.0.1.0/24)</div>
            <div class="diagram-row">
              <div class="diagram-box compute">
                <div class="box-title">프론트엔드 EC2</div>
                <div class="box-sub">Nginx + React<br>SG: 80(모든곳)</div>
              </div>
              <div class="diagram-box network">
                <div class="box-title">NAT 게이트웨이</div>
              </div>
            </div>
          </div>
          <div class="diagram-arrow down">↓</div>
          <div class="diagram-group subnet-priv">
            <div class="diagram-group-label">프라이빗 서브넷 (10.0.2.0/24)</div>
            <div class="diagram-row">
              <div class="diagram-box compute">
                <div class="box-title">API 서버 EC2</div>
                <div class="box-sub">Node.js + SQLite<br>SG: 5000(프론트SG만)</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <h3>핵심 설계 포인트</h3>
      <ul>
        <li><strong>프론트엔드 EC2</strong>: 퍼블릭 서브넷에 배치, 인터넷에서 HTTP(80) 접근 가능</li>
        <li><strong>API 서버 EC2</strong>: 프라이빗 서브넷에 배치, 프론트엔드 EC2에서만 5000번 포트 접근 가능</li>
        <li><strong>NAT 게이트웨이</strong>: 프라이빗 서브넷의 API 서버가 npm 패키지 설치 등 인터넷 접근이 필요할 때 사용</li>
        <li><strong>보안그룹 체이닝</strong>: API 서버 보안그룹에서 프론트엔드 보안그룹 ID를 소스로 지정</li>
      </ul>

      <div class="info-box warning">
        <div class="info-box-title">기존 EC2와의 관계</div>
        <p>이번 실습에서는 새로운 EC2 인스턴스를 생성합니다. 기존에 만든 EC2 인스턴스는 비교를 위해 잠시 유지하되, 실습이 끝나면 중지하여 비용을 절약하세요.</p>
      </div>
    </section>

    <!-- Lab Section -->
    <section class="content-section" id="lab">
      <h2>실습</h2>

      <div class="lab-section">
        <div class="lab-title">실습: ShopEasy를 VPC에 재배포하기</div>

        <div class="info-box danger">
          <div class="info-box-title">비용 주의</div>
          <p><strong>NAT 게이트웨이</strong>는 시간당 약 $0.045의 비용이 발생합니다. 실습이 끝난 후 반드시 삭제하세요. EC2 인스턴스는 t2.micro 프리티어를 사용합니다.</p>
        </div>

        <p>이전 챕터(Chapter 8, 9)에서 생성한 VPC, 서브넷, 인터넷 게이트웨이, NAT 게이트웨이가 이미 있다고 가정합니다. 없다면 먼저 해당 챕터의 실습을 완료하세요.</p>

        <ol class="steps">
          <!-- Step 1 -->
          <li class="step">
            <div class="step-title">VPC 및 서브넷 확인</div>
            <p>이전에 생성한 VPC 리소스가 있는지 확인합니다.</p>
            <p><strong>AWS 콘솔 &rarr; VPC &rarr; Your VPCs</strong>로 이동합니다.</p>
            <ul>
              <li>VPC: <code>shop-vpc</code> (10.0.0.0/16) 확인</li>
              <li>퍼블릭 서브넷: <code>shop-public-subnet-2a</code> (10.0.1.0/24) 확인</li>
              <li>프라이빗 서브넷: <code>shop-private-subnet-2a</code> (10.0.10.0/24) 확인</li>
              <li>인터넷 게이트웨이: VPC에 연결되어 있는지 확인</li>
              <li>NAT 게이트웨이: 퍼블릭 서브넷에 생성되어 있는지 확인</li>
            </ul>
            <img src="../assets/images/chapter10/confirm-VPC.png" alt="VPC 확인">

            <div class="info-box tip">
              <div class="info-box-title">리소스가 없다면?</div>
              <p>Chapter 8, 9 실습을 먼저 완료하거나, 아래 AWS CLI 명령어로 빠르게 생성할 수 있습니다.</p>
            </div>

            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># VPC 생성
aws ec2 create-vpc --cidr-block 10.0.0.0/16 --tag-specifications 'ResourceType=vpc,Tags=[{Key=Name,Value=my-vpc}]'

# 퍼블릭 서브넷 생성
aws ec2 create-subnet --vpc-id &lt;vpc-id&gt; --cidr-block 10.0.1.0/24 --availability-zone ap-northeast-2a --tag-specifications 'ResourceType=subnet,Tags=[{Key=Name,Value=public-subnet-a}]'

# 프라이빗 서브넷 생성
aws ec2 create-subnet --vpc-id &lt;vpc-id&gt; --cidr-block 10.0.2.0/24 --availability-zone ap-northeast-2a --tag-specifications 'ResourceType=subnet,Tags=[{Key=Name,Value=private-subnet-a}]'</code></pre>
            </div>
          </li>

          <!-- Step 2 -->
          <li class="step">
            <div class="step-title">프론트엔드 EC2 및 보안그룹 생성</div>
            <p><strong>AWS 콘솔 &rarr; EC2 &rarr; Instances &rarr; Launch instances</strong></p>
            <ul>
              <li><strong>Name</strong>: <code>shop-front</code></li>
              <li><strong>AMI</strong>: Amazon Linux 2023</li>
              <li><strong>Instance type</strong>: t2.micro (프리티어)</li>
              <li><strong>Key pair</strong>: 기존 키페어 선택</li>
            </ul>
            <p><strong>Network settings</strong>에서 <strong>Edit</strong> 클릭:</p>
            <ul>
              <li><strong>VPC</strong>: <code>shop-VPC</code></li>
              <li><strong>Subnet</strong>: <code>shop-public-subnet-1</code></li>
              <li><strong>Auto-assign public IP</strong>: <strong>Enable</strong></li>
              <li><strong>Security group</strong>: <code>shop-frontend-sg</code>(보안 그룹 생성)
                <ul>
                  <li><strong>Security group name</strong>: <code>shop-frontend-sg</code></li>
                  <li><strong>Description</strong>: <code>shop-frontend-sg</code></li>
                  <li><strong>VPC</strong>: <code>shop-VPC</code> 선택</li>
                </ul>
              </li>
            </ul>
            <p><strong>Inbound rules</strong>에서 <strong>Add rule</strong> 클릭:</p>
            <table>
              <thead>
                <tr><th>Type</th><th>Port</th><th>Source</th><th>설명</th></tr>
              </thead>
              <tbody>
                <tr><td>SSH</td><td>22</td><td>내 IP</td><td>SSH 접속 (관리용)</td></tr>
                <tr><td>HTTP</td><td>80</td><td>0.0.0.0/0</td><td>웹 브라우저 접근</td></tr>
              </tbody>
            </table>
            <img src="../assets/images/chapter10/create-frontend-sg1.png" alt="shop-frontend-sg 생성">
            <img src="../assets/images/chapter10/create-frontend-sg2.png" alt="shop-frontend-sg 생성">
            <p><strong>Launch instance</strong> 클릭</p>
          </li>

          <!-- Step 3 -->
          <li class="step">
            <div class="step-title">API 서버 EC2 및 보안그룹 생성 </div>
            <p><strong>AWS 콘솔 &rarr; EC2 &rarr; Instances &rarr; Launch instances</strong></p>
            <ul>
              <li><strong>Name</strong>: <code>shop-api-server</code></li>
              <li><strong>AMI</strong>: Amazon Linux 2023</li>
              <li><strong>Instance type</strong>: t2.micro (프리티어)</li>
              <li><strong>Key pair</strong>: 기존 키페어 선택</li>
            </ul>
            <p><strong>Network settings</strong>에서 <strong>Edit</strong> 클릭:</p>
            <ul>
              <li><strong>VPC</strong>: <code>shop-VPC</code></li>
              <li><strong>Subnet</strong>: <code>shop-private-subnet-1</code></li>
              <li><strong>Auto-assign public IP</strong>: <strong>Disable</strong></li>
              <li><strong>Security group</strong>: <code>shop-api-server-sg</code> (보안 그룹 생성)
                <ul>
                  <li><strong>Security group name</strong>: <code>shop-api-server-sg</code></li>
                  <li><strong>Description</strong>: <code>shop-api-server-sg</code></li>
                  <li><strong>VPC</strong>: <code>shop-VPC</code> 선택</li>
                </ul>
              </li>
            </ul>
            <p><strong>Inbound rules</strong>에서 <strong>Add rule</strong> 클릭:</p>
            <table>
              <thead>
                <tr><th>Type</th><th>Port</th><th>Source</th><th>설명</th></tr>
              </thead>
              <tbody>
                <tr><td>SSH</td><td>22</td><td><strong>shop-frontend-sg</strong></td><td>프론트엔드를 통한 SSH (Bastion)</td></tr>
                <tr><td>Custom TCP</td><td>5000</td><td><strong>shop-frontend-sg</strong></td><td>프론트엔드에서만 API 접근</td></tr>
              </tbody>
            </table>

            <div class="info-box analogy">
              <div class="info-box-title">비유로 이해하기: 보안그룹 체이닝</div>
              <p>Source에 IP 대신 <strong>보안그룹 ID</strong>를 넣는 것은, "이 출입증(shop-frontend-sg)을 가진 사람만 들어올 수 있다"라고 설정하는 것입니다. IP 주소가 바뀌어도 상관없이, 해당 보안그룹에 속해 있기만 하면 접근이 허용됩니다.</p>
            </div>

            <img src="../assets/images/chapter10/create-api-server-sg1.png" alt="shop-api-server-sg 생성">
            <img src="../assets/images/chapter10/create-api-server-sg2.png" alt="shop-api-server-sg 생성">
            <p><strong>Launch instance</strong> 클릭</p>
            <div class="info-box warning">
              <div class="info-box-title">프라이빗 서브넷 EC2는 퍼블릭 IP가 없습니다</div>
              <p>프라이빗 서브넷의 EC2에는 퍼블릭 IP가 할당되지 않습니다. SSH 접속은 프론트엔드 EC2를 Bastion Host(점프 서버)로 사용해야 합니다.</p>
            </div>
          </li>

          <!-- Step 4 -->
          <li class="step">
            <div class="step-title">프론트엔드 EC2에 SSH 접속 후 Nginx + React 배포</div>
            <p>프론트엔드 EC2에 SSH로 접속합니다.</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 프론트엔드 EC2에 SSH 접속
ssh -i my-keypair.pem ec2-user@&lt;프론트엔드-퍼블릭-IP&gt;</code></pre>
            </div>

            <p>Nginx 설치 및 설정:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 시스템 업데이트 및 Nginx 설치
sudo dnf update -y
sudo dnf install -y nginx

# Nginx 시작 및 부팅 시 자동 시작 설정
sudo systemctl start nginx
sudo systemctl enable nginx</code></pre>
            </div>

            <p>React 앱 빌드 파일을 배포합니다. 먼저 Node.js를 설치하고 프로젝트를 빌드합니다:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># Node.js 설치
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo dnf install -y nodejs

# 프로젝트 클론
git clone https://github.com/your-repo/ecommerce-app.git
cd ecommerce-app/frontend

# 환경변수 설정 - API 서버의 프라이빗 IP를 지정
echo "VITE_API_URL=http://&lt;프론트엔드-퍼블릭-IP&gt;/api" > .env

# 빌드
npm install
npm run build

# 빌드 파일을 Nginx 웹 루트에 복사
sudo cp -r dist/* /usr/share/nginx/html/</code></pre>
            </div>

            <p>Nginx에 리버스 프록시 설정을 추가합니다 (API 요청을 프라이빗 서브넷의 API 서버로 전달):</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># Nginx 설정 파일 편집
sudo tee /etc/nginx/conf.d/shopeasy.conf > /dev/null &lt;&lt;'EOF'
server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;
    index index.html;

    # React SPA 라우팅
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API 요청을 프라이빗 서브넷의 API 서버로 프록시
    location /api/ {
        proxy_pass http://&lt;API-서버-프라이빗-IP&gt;:5000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
EOF

# 기본 설정 파일의 server 블록 비활성화
sudo sed -i 's/listen       80;/# listen       80;/' /etc/nginx/nginx.conf

# 설정 테스트 및 재시작
sudo nginx -t
sudo systemctl restart nginx</code></pre>
            </div>
          </li>

          <!-- Step 7 -->
          <li class="step">
            <div class="step-title">프라이빗 EC2에 SSH 접속 (Bastion Host 경유)</div>
            <p>프라이빗 서브넷의 API 서버에 직접 SSH 접속은 불가능합니다. 프론트엔드 EC2를 <strong>Bastion Host(점프 서버)</strong>로 사용합니다.</p>

            <div class="info-box analogy">
              <div class="info-box-title">비유로 이해하기: Bastion Host</div>
              <p>Bastion Host는 <strong>건물의 경비실</strong>과 같습니다. 외부인이 건물 내부(프라이빗 서브넷)에 들어가려면, 먼저 경비실(Bastion Host)을 거쳐야 합니다. 경비실에서 신원 확인이 된 후에만 내부로 진입할 수 있죠.</p>
            </div>

            <!-- <p>먼저, 프론트엔드 EC2에 키페어 파일을 복사합니다:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 로컬에서 키페어를 프론트엔드 EC2로 복사
scp -i my-keypair.pem my-keypair.pem ec2-user@&lt;프론트엔드-퍼블릭-IP&gt;:~/</code></pre>
            </div>

            <p>프론트엔드 EC2에서 API 서버 EC2로 SSH 접속:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 프론트엔드 EC2에 접속한 상태에서
chmod 400 my-keypair.pem

# 프라이빗 서브넷의 API 서버로 SSH 접속
ssh -i my-keypair.pem ec2-user@&lt;API-서버-프라이빗-IP&gt;</code></pre>
            </div> -->

            <!-- <div class="info-box tip">
              <div class="info-box-title">SSH Agent Forwarding (더 편리한 방법)</div>
              <p>키페어를 복사하는 대신, SSH Agent Forwarding을 사용하면 더 안전합니다:</p>
            </div> -->
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># Local에서 Key가 있는 위치에서 시작한 후 아래 명령어 실행
# 로컬에서 SSH Agent에 키 추가
ssh-add my-keypair.pem

# -A 옵션으로 Agent Forwarding 활성화
ssh -A -i my-keypair.pem ec2-user@&lt;프론트엔드-퍼블릭-IP&gt;

# 프론트엔드에서 API 서버로 키페어 파일 없이 접속 가능
ssh ec2-user@&lt;API-서버-프라이빗-IP&gt;</code></pre>
            </div>
          </li>

          <!-- Step 8 -->
          <li class="step">
            <div class="step-title">API 서버 EC2에 Node.js 앱 배포</div>
            <p>API 서버 EC2에 접속한 상태에서 Node.js와 앱을 설치합니다.</p>

            <div class="info-box warning">
              <div class="info-box-title">인터넷 연결이 안 된다면?</div>
              <p>프라이빗 서브넷의 라우팅 테이블에 NAT 게이트웨이로의 경로(0.0.0.0/0 &rarr; NAT GW)가 설정되어 있는지 확인하세요. Chapter 9에서 설정한 내용입니다.</p>
            </div>

            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># Node.js 설치
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo dnf install -y nodejs git

# 프로젝트 클론
git clone https://github.com/your-repo/ecommerce-app.git
cd ecommerce-app/api-server

# 의존성 설치
npm install

# 환경변수 설정
cat > .env &lt;&lt;'EOF'
PORT=5000
DB_TYPE=sqlite
NODE_ENV=production
EOF

# 서버 시작 (백그라운드)
npm start &</code></pre>
            </div>

            <p>API 서버가 정상적으로 실행되는지 확인합니다.</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># API 서버 상태 확인
curl http://localhost/api/products</code></pre>
            </div>
          </li>

          <!-- Step 9 -->
          <li class="step">
            <div class="step-title">프론트엔드에서 API 연동 확인</div>
            <p>프론트엔드 EC2에서 프라이빗 서브넷의 API 서버에 접근이 되는지 확인합니다.</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 프론트엔드 EC2에서 API 서버 접근 테스트
curl http://&lt;API-서버-프라이빗-IP&gt;/api/products</code></pre>
            </div>

            <p>이제 브라우저에서 프론트엔드 EC2의 퍼블릭 IP로 접속합니다.</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 브라우저에서 접속
http://&lt;프론트엔드-퍼블릭-IP&gt;</code></pre>
            </div>

            <p>ShopEasy 쇼핑몰이 정상적으로 로드되고, 상품 목록이 표시되면 성공</p>
          </li>

          <!-- Step 10 -->
          <!-- <li class="step">
            <div class="step-title">보안 검증 - 외부에서 API 서버 직접 접근 차단 확인</div>
            <p>API 서버가 정말 외부에서 접근 불가능한지 확인합니다.</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 로컬 컴퓨터에서 API 서버 프라이빗 IP로 접근 시도 (타임아웃 발생해야 정상)
curl --connect-timeout 5 http://&lt;API-서버-프라이빗-IP&gt;:5000/api/products
# 결과: Connection timed out (정상 - 외부에서 접근 불가)</code></pre>
            </div>

            <div class="info-box tip">
              <div class="info-box-title">성공 기준</div>
              <ul>
                <li>브라우저에서 프론트엔드 퍼블릭 IP로 접속: 쇼핑몰 정상 동작</li>
                <li>로컬에서 API 서버 프라이빗 IP로 접속: 타임아웃(접근 불가)</li>
                <li>프론트엔드 EC2에서 API 서버로 curl: 정상 응답</li>
              </ul>
            </div>
          </li>

          <!-- Step 11 -->
          <!-- <li class="step">
            <div class="step-title">PM2로 API 서버 프로세스 관리</div>
            <p>API 서버가 안정적으로 실행되도록 PM2를 설치합니다.</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># API 서버 EC2에서 (Bastion 경유 접속)
sudo npm install -g pm2

# PM2로 API 서버 실행
cd ~/ecommerce-app/api-server
pm2 start npm --name "shopeasy-api" -- start

# 부팅 시 자동 시작 설정
pm2 startup
pm2 save

# 상태 확인
pm2 status</code></pre>
            </div>
            <div class="screenshot-placeholder">[스크린샷: PM2 상태 화면 - shopeasy-api 프로세스]</div>
          </li> -->
        </ol>
      </div>

      <div class="info-box concept">
        <div class="info-box-title">이번 챕터에서 달성한 것</div>
        <ul>
          <li>프론트엔드를 퍼블릭 서브넷에 배치하여 인터넷에서 접근 가능</li>
          <li>API 서버를 프라이빗 서브넷에 배치하여 외부 접근 차단</li>
          <li>보안그룹 체이닝으로 프론트엔드 &rarr; API 통신만 허용</li>
          <li>NAT 게이트웨이를 통해 프라이빗 EC2의 인터넷 접근 확보</li>
          <li>Bastion Host 패턴으로 프라이빗 EC2 관리</li>
        </ul>
      </div>
    </section>

    <div class="chapter-nav">
      <a href="09-vpc-advanced.html" class="prev">이전: VPC 심화</a>
      <a href="11-alb.html" class="next">다음: ALB (Application Load Balancer)</a>
    </div>
  </main>
</div>

<script src="../assets/js/main.js"></script>
</body>

</html>
