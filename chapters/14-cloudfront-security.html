<!DOCTYPE html>
<html lang="ko">

<!-- Mirrored from rapa-aws-security.vercel.app/chapters/14-cloudfront-security.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Feb 2026 08:26:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CloudFront 보안 - AWS 클라우드 보안</title>
  <link href="../../cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>

<header class="site-header">
  <div class="header-inner">
    <a href="../index-2.html" class="header-logo">
      <span class="aws-icon">&#x1F6E1; AWS Security</span>
      <span>클라우드 보안 강의</span>
    </a>
  </div>
</header>

<div class="page-layout">
  <nav class="sidebar">
    <ul class="sidebar-nav">
      <li class="sidebar-section">CloudFront 보안</li>
      <li><a href="#cloudfront-overview">CloudFront 보안 개요</a></li>
      <li><a href="#oac">OAC - S3 직접 접근 차단</a></li>
      <li><a href="#signed-url">Signed URL & Cookie</a></li>
      <li><a href="#geo-restriction">지역 제한</a></li>
      <li><a href="#https-tls">HTTPS 강제 & TLS 정책</a></li>
      <li><a href="#security-headers">보안 헤더</a></li>
      <li class="sidebar-section">실습</li>
      <li><a href="#lab-oac">실습: OAC 설정</a></li>
    </ul>
  </nav>

  <main class="main-content">
    <div class="chapter-header">
      <span class="chapter-num">Chapter 14</span>
      <h1>CloudFront 보안</h1>
      <div class="objectives">
        <h3>학습 목표</h3>
        <ul>
          <li>CloudFront가 엣지에서 제공하는 보안 계층의 역할을 이해한다</li>
          <li>OAC(Origin Access Control)를 설정하여 S3 직접 접근을 차단할 수 있다</li>
          <li>Signed URL과 Signed Cookie를 사용하여 프리미엄 콘텐츠를 보호할 수 있다</li>
          <li>HTTPS를 강제하고 적절한 TLS 보안 정책을 선택할 수 있다</li>
          <li>보안 헤더(CSP, HSTS 등)를 CloudFront 응답 헤더 정책으로 적용할 수 있다</li>
        </ul>
      </div>
    </div>

    <!-- Section 1: CloudFront 보안 개요 -->
    <section class="content-section" id="cloudfront-overview">
      <h2>1. CloudFront 보안 개요</h2>

      <p>Amazon CloudFront는 단순한 CDN이 아니라 애플리케이션의 <strong>첫 번째 보안 방어선</strong>입니다. 전 세계 엣지 로케이션에서 트래픽을 처리하기 때문에, 오리진 서버에 도달하기 전에 다양한 보안 정책을 적용할 수 있습니다.</p>

      <div class="diagram">
        <div class="diagram-title">CloudFront 보안 계층 아키텍처</div>
        <div class="diagram-row">
          <div class="diagram-box user">
            <div class="box-title">사용자</div>
            <div class="box-sub">전 세계 클라이언트</div>
          </div>
          <div class="diagram-arrow">&rarr;</div>
          <div class="diagram-box waf">
            <div class="box-title">AWS WAF</div>
            <div class="box-sub">웹 공격 차단</div>
          </div>
          <div class="diagram-arrow">&rarr;</div>
          <div class="diagram-box shield">
            <div class="box-title">AWS Shield</div>
            <div class="box-sub">DDoS 방어</div>
          </div>
          <div class="diagram-arrow">&rarr;</div>
          <div class="diagram-box cdn">
            <div class="box-title">CloudFront</div>
            <div class="box-sub">엣지 보안 정책</div>
          </div>
          <div class="diagram-arrow">&rarr;</div>
          <div class="diagram-box storage">
            <div class="box-title">S3 / ALB</div>
            <div class="box-sub">오리진 서버</div>
          </div>
        </div>
      </div>

      <h3>CloudFront가 제공하는 보안 기능</h3>

      <table>
        <thead>
          <tr><th>보안 기능</th><th>설명</th><th>보호 대상</th></tr>
        </thead>
        <tbody>
          <tr><td>OAC (Origin Access Control)</td><td>S3 오리진에 CloudFront만 접근 허용</td><td>S3 버킷</td></tr>
          <tr><td>Signed URL / Signed Cookie</td><td>인증된 사용자만 콘텐츠 접근</td><td>프리미엄 콘텐츠</td></tr>
          <tr><td>지역 제한 (Geo Restriction)</td><td>특정 국가에서의 접근 차단/허용</td><td>저작권 콘텐츠</td></tr>
          <tr><td>HTTPS 강제</td><td>HTTP 요청을 HTTPS로 리다이렉트</td><td>전송 데이터</td></tr>
          <tr><td>보안 헤더</td><td>CSP, HSTS 등 HTTP 보안 헤더 추가</td><td>브라우저 보안</td></tr>
          <tr><td>AWS WAF 연동</td><td>SQL Injection, XSS 등 웹 공격 차단</td><td>웹 애플리케이션</td></tr>
          <tr><td>AWS Shield 통합</td><td>DDoS 방어 (Standard 무료)</td><td>가용성</td></tr>
          <tr><td>필드 레벨 암호화</td><td>특정 POST 필드를 엣지에서 암호화</td><td>민감 폼 데이터</td></tr>
        </tbody>
      </table>

      <div class="info-box concept">
        <div class="info-box-title">ShopEasy에서의 CloudFront 역할</div>
        <p>기초 과정에서 ShopEasy 프론트엔드를 S3 + CloudFront로 배포했습니다. 하지만 보안 설정 없이 배포했기 때문에 S3 버킷에 직접 접근이 가능하고, HTTPS가 강제되지 않으며, 보안 헤더도 없는 상태입니다. 이번 챕터에서 이 모든 보안 이슈를 해결합니다.</p>
      </div>
    </section>

    <!-- Section 2: OAC -->
    <section class="content-section" id="oac">
      <h2>2. OAC (Origin Access Control) - S3 직접 접근 차단</h2>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 백화점 정문과 직원 출입구</div>
        <p>백화점에서 고객은 반드시 <strong>정문(CloudFront)</strong>을 통해 입장해야 합니다. 직원 출입구(S3 직접 접근)로 들어오는 것은 허용되지 않습니다. 정문에서는 신원 확인, 보안 검색 등을 수행할 수 있고, 고객의 동선을 관리할 수 있습니다.</p>
      </div>

      <h3>OAI에서 OAC로 진화</h3>

      <table>
        <thead>
          <tr><th>비교 항목</th><th>OAI (레거시)</th><th>OAC (권장)</th></tr>
        </thead>
        <tbody>
          <tr><td>SSE-KMS 지원</td><td>미지원</td><td><strong>지원</strong></td></tr>
          <tr><td>SigV4 서명</td><td>미지원</td><td><strong>지원</strong></td></tr>
          <tr><td>모든 리전 S3</td><td>일부 리전 제한</td><td><strong>모든 리전 지원</strong></td></tr>
          <tr><td>동적 요청</td><td>GET, HEAD만</td><td><strong>모든 HTTP 메서드</strong></td></tr>
          <tr><td>AWS 권장</td><td>레거시 (마이그레이션 권장)</td><td><strong>신규 생성 시 기본 선택</strong></td></tr>
        </tbody>
      </table>

      <div class="info-box warning">
        <div class="info-box-title">주의: OAI 마이그레이션</div>
        <p>기존에 OAI를 사용하고 있다면 OAC로 마이그레이션하는 것이 권장됩니다. 특히 <strong>KMS 암호화를 사용하는 S3 버킷</strong>이라면 OAC가 필수입니다. OAI는 KMS 암호화된 객체를 복호화할 수 없습니다.</p>
      </div>

      <h3>OAC 동작 방식</h3>

      <div class="diagram">
        <div class="diagram-title">OAC를 통한 S3 접근 제어</div>
        <div class="diagram-row">
          <div class="diagram-box user">
            <div class="box-title">정상 사용자</div>
            <div class="box-sub">CloudFront URL</div>
          </div>
          <div class="diagram-arrow">&rarr;</div>
          <div class="diagram-box cdn">
            <div class="box-title">CloudFront</div>
            <div class="box-sub">SigV4 서명 추가</div>
          </div>
          <div class="diagram-arrow">&rarr;</div>
          <div class="diagram-box storage">
            <div class="box-title">S3 버킷</div>
            <div class="box-sub">200 OK</div>
          </div>
        </div>
        <div class="diagram-row">
          <div class="diagram-box user">
            <div class="box-title">악의적 사용자</div>
            <div class="box-sub">S3 URL 직접 접근</div>
          </div>
          <div class="diagram-arrow">&rarr;</div>
          <div class="diagram-box security">
            <div class="box-title">S3 버킷 정책</div>
            <div class="box-sub">403 Forbidden!</div>
          </div>
        </div>
      </div>

      <h3>OAC에 필요한 S3 버킷 정책</h3>

      <div class="code-block">
        <div class="code-header">
          <span class="lang">json</span>
          <button class="copy-btn">복사</button>
        </div>
        <pre><code>{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowCloudFrontServicePrincipalReadOnly",
      "Effect": "Allow",
      "Principal": {
        "Service": "cloudfront.amazonaws.com"
      },
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::shopeasy-product-images/*",
      "Condition": {
        "StringEquals": {
          "AWS:SourceArn": "arn:aws:cloudfront::123456789012:distribution/E1A2B3C4D5E6F7"
        }
      }
    }
  ]
}</code></pre>
      </div>

      <div class="info-box tip">
        <div class="info-box-title">팁: 버킷 정책의 핵심 포인트</div>
        <p><code>Principal</code>이 <code>cloudfront.amazonaws.com</code> 서비스이고, <code>Condition</code>에서 특정 CloudFront 배포의 ARN을 지정합니다. 이렇게 하면 <strong>해당 CloudFront 배포만</strong> S3에 접근할 수 있습니다.</p>
      </div>
    </section>

    <!-- Section 3: Signed URL & Signed Cookie -->
    <section class="content-section" id="signed-url">
      <h2>3. Signed URL & Signed Cookie</h2>

      <div class="info-box concept">
        <div class="info-box-title">핵심 개념: 콘텐츠 접근 제한</div>
        <p>Signed URL과 Signed Cookie는 <strong>특정 조건을 만족하는 사용자에게만 콘텐츠를 제공</strong>하는 방법입니다. 유효 기간, 허용 IP 등을 지정하여 인증된 사용자만 콘텐츠를 다운로드하거나 스트리밍할 수 있습니다.</p>
      </div>

      <h3>Signed URL vs Signed Cookie 비교</h3>

      <table>
        <thead>
          <tr><th>비교 항목</th><th>Signed URL</th><th>Signed Cookie</th></tr>
        </thead>
        <tbody>
          <tr><td>적용 범위</td><td><strong>단일 파일</strong>에 대한 접근 허용</td><td><strong>여러 파일</strong>에 대한 접근 허용</td></tr>
          <tr><td>URL 변경</td><td>URL에 서명 파라미터가 추가됨</td><td>URL은 그대로, 쿠키로 인증</td></tr>
          <tr><td>사용 사례</td><td>개별 파일 다운로드 (영수증 PDF 등)</td><td>유료 회원 전체 콘텐츠 (HLS 스트리밍 등)</td></tr>
          <tr><td>IP 제한</td><td>가능</td><td>가능</td></tr>
          <tr><td>구현 복잡도</td><td>단순 (URL 생성만)</td><td>약간 복잡 (쿠키 설정 필요)</td></tr>
        </tbody>
      </table>

      <div class="diagram">
        <div class="diagram-title">Signed URL 발급 흐름</div>
        <div class="diagram-row">
          <div class="diagram-box user">
            <div class="box-title">1. 사용자</div>
            <div class="box-sub">다운로드 요청</div>
          </div>
          <div class="diagram-arrow">&rarr;</div>
          <div class="diagram-box compute">
            <div class="box-title">2. 앱 서버</div>
            <div class="box-sub">권한 확인 + URL 생성</div>
          </div>
          <div class="diagram-arrow">&rarr;</div>
          <div class="diagram-box cdn">
            <div class="box-title">3. CloudFront</div>
            <div class="box-sub">서명 검증</div>
          </div>
          <div class="diagram-arrow">&rarr;</div>
          <div class="diagram-box storage">
            <div class="box-title">4. S3</div>
            <div class="box-sub">콘텐츠 반환</div>
          </div>
        </div>
      </div>

      <h3>Signed URL 생성 (Node.js)</h3>

      <div class="code-block">
        <div class="code-header">
          <span class="lang">javascript</span>
          <button class="copy-btn">복사</button>
        </div>
        <pre><code>// Node.js - Signed URL 생성
const { getSignedUrl } = require('@aws-sdk/cloudfront-signer');
const fs = require('fs');

// 프라이빗 키 로드 (Secrets Manager에서 가져오는 것을 권장)
const privateKey = fs.readFileSync('private_key.pem', 'utf8');

function createSignedUrl(resourcePath, expiresInMinutes = 60) {
  const cloudFrontDomain = 'https://d1234567890.cloudfront.net';
  const url = `${cloudFrontDomain}${resourcePath}`;

  const signedUrl = getSignedUrl({
    url: url,
    keyPairId: 'K2EXAMPLE12345',  // CloudFront 퍼블릭 키 ID
    dateLessThan: new Date(Date.now() + expiresInMinutes * 60 * 1000).toISOString(),
    privateKey: privateKey
  });
  return signedUrl;
}

// ShopEasy API 라우트 예시
app.get('/api/download/receipt/:orderId', async (req, res) => {
  const userId = req.user.id;
  const orderId = req.params.orderId;

  // 해당 주문이 사용자의 것인지 확인
  const order = await db.query(
    'SELECT * FROM orders WHERE id = ? AND user_id = ?',
    [orderId, userId]
  );
  if (!order) {
    return res.status(403).json({ error: '접근 권한이 없습니다.' });
  }

  // Signed URL 생성 (10분 유효)
  const signedUrl = createSignedUrl(`/receipts/${orderId}.pdf`, 10);
  res.json({ downloadUrl: signedUrl });
});</code></pre>
      </div>

      <div class="info-box concept">
        <div class="info-box-title">Trusted Key Groups (권장) vs CloudFront Key Pairs (레거시)</div>
        <p>레거시 방식인 CloudFront Key Pairs는 루트 계정으로만 관리할 수 있었습니다. 새로운 <strong>Trusted Key Groups</strong> 방식은 IAM으로 관리하며, 여러 퍼블릭 키를 그룹으로 묶어 사용할 수 있습니다. 새 배포에서는 반드시 Trusted Key Groups를 사용하세요.</p>
      </div>

      <div class="info-box warning">
        <div class="info-box-title">주의: Signed URL 보안 고려사항</div>
        <ul>
          <li><strong>URL 공유 방지</strong> - IP 제한을 추가하면 URL 공유를 방지할 수 있습니다</li>
          <li><strong>프라이빗 키 보호</strong> - 서명에 사용하는 프라이빗 키는 반드시 Secrets Manager에 저장하세요</li>
          <li><strong>만료 시간은 짧게</strong> - 필요 이상으로 길게 설정하지 마세요</li>
          <li><strong>HTTPS 사용</strong> - HTTP로 서비스하면 URL이 중간에 탈취될 수 있습니다</li>
        </ul>
      </div>
    </section>

    <!-- Section 4: 지역 제한 -->
    <section class="content-section" id="geo-restriction">
      <h2>4. 지역 제한 (Geo Restriction) 설정</h2>

      <div class="info-box concept">
        <div class="info-box-title">핵심 개념: Geo Restriction</div>
        <p>CloudFront의 지역 제한은 <strong>사용자의 지리적 위치(국가)</strong>에 따라 콘텐츠 접근을 허용하거나 차단하는 기능입니다. 국가 코드(ISO 3166-1 alpha-2)를 기반으로 동작합니다.</p>
      </div>

      <table>
        <thead>
          <tr><th>방식</th><th>설명</th><th>사용 사례</th></tr>
        </thead>
        <tbody>
          <tr><td><strong>허용 목록 (Allowlist)</strong></td><td>지정한 국가에서만 접근 허용</td><td>한국 전용 서비스</td></tr>
          <tr><td><strong>차단 목록 (Blocklist)</strong></td><td>지정한 국가에서의 접근 차단</td><td>제재 대상국가 차단</td></tr>
        </tbody>
      </table>

      <div class="code-block">
        <div class="code-header">
          <span class="lang">json</span>
          <button class="copy-btn">복사</button>
        </div>
        <pre><code>{
  "Restrictions": {
    "GeoRestriction": {
      "RestrictionType": "whitelist",
      "Quantity": 2,
      "Items": ["KR", "JP"]
    }
  }
}</code></pre>
      </div>

      <div class="info-box warning">
        <div class="info-box-title">지역 제한의 한계</div>
        <p>CloudFront의 지역 제한은 IP 기반의 GeoIP 데이터베이스를 사용합니다. VPN을 사용하는 사용자는 우회할 수 있으므로, 엄격한 접근 제어가 필요한 경우 Signed URL과 함께 사용하세요. 도시/지역 단위의 정밀한 제한이 필요하면 <strong>Lambda@Edge</strong>나 <strong>AWS WAF</strong>의 지리적 일치 조건을 활용하세요.</p>
      </div>
    </section>

    <!-- Section 5: HTTPS 강제 & TLS 정책 -->
    <section class="content-section" id="https-tls">
      <h2>5. HTTPS 강제 & TLS 정책</h2>

      <div class="info-box concept">
        <div class="info-box-title">핵심 개념: 전송 구간 암호화</div>
        <p>CloudFront에서 HTTPS를 강제하면 <strong>사용자와 CloudFront 간, CloudFront와 오리진 간</strong>의 모든 통신이 암호화됩니다. 중간자 공격(MITM), 데이터 도청, 세션 하이재킹 등을 방지할 수 있습니다.</p>
      </div>

      <h3>Viewer Protocol Policy (사용자 - CloudFront)</h3>

      <table>
        <thead>
          <tr><th>정책</th><th>동작</th><th>권장 여부</th></tr>
        </thead>
        <tbody>
          <tr><td><strong>HTTP and HTTPS</strong></td><td>HTTP와 HTTPS 모두 허용</td><td>비권장</td></tr>
          <tr><td><strong>Redirect HTTP to HTTPS</strong></td><td>HTTP를 HTTPS로 리다이렉트 (301)</td><td><strong>권장</strong></td></tr>
          <tr><td><strong>HTTPS Only</strong></td><td>HTTPS만 허용, HTTP는 403</td><td>API 전용 배포에 권장</td></tr>
        </tbody>
      </table>

      <h3>Origin Protocol Policy (CloudFront - 오리진)</h3>

      <table>
        <thead>
          <tr><th>정책</th><th>동작</th><th>사용 사례</th></tr>
        </thead>
        <tbody>
          <tr><td><strong>HTTP Only</strong></td><td>오리진에 HTTP로만 연결</td><td>S3 웹사이트 엔드포인트</td></tr>
          <tr><td><strong>HTTPS Only</strong></td><td>오리진에 HTTPS로만 연결</td><td>ALB, API Gateway</td></tr>
          <tr><td><strong>Match Viewer</strong></td><td>뷰어 프로토콜과 동일하게</td><td>일반적인 경우</td></tr>
        </tbody>
      </table>

      <h3>TLS 최소 버전 정책</h3>

      <table>
        <thead>
          <tr><th>보안 정책</th><th>최소 TLS</th><th>호환성</th><th>권장</th></tr>
        </thead>
        <tbody>
          <tr><td>TLSv1.2_2021</td><td><strong>TLS 1.2</strong></td><td>최신 브라우저</td><td><strong>결제 서비스 권장</strong></td></tr>
          <tr><td>TLSv1.2_2019</td><td>TLS 1.2</td><td>대부분 현대 브라우저</td><td>일반 웹사이트 권장</td></tr>
          <tr><td>TLSv1.1_2016</td><td>TLS 1.1</td><td>레거시 포함</td><td>비권장</td></tr>
          <tr><td>TLSv1_2016</td><td>TLS 1.0</td><td>매우 오래된 클라이언트</td><td>보안 취약</td></tr>
        </tbody>
      </table>

      <div class="info-box danger">
        <div class="info-box-title">위험: TLS 1.0/1.1은 보안 취약합니다</div>
        <p>TLS 1.0과 1.1은 BEAST, POODLE 등의 취약점이 알려져 있으며, PCI DSS에서도 <strong>TLS 1.2 이상을 요구</strong>합니다. ShopEasy처럼 결제 기능이 있는 서비스는 반드시 <strong>TLSv1.2_2021</strong>을 사용하세요.</p>
      </div>

      <h3>ACM 인증서 연동</h3>

      <div class="info-box warning">
        <div class="info-box-title">주의: CloudFront용 인증서는 반드시 us-east-1 리전에서 생성!</div>
        <p>CloudFront는 글로벌 서비스이므로, CloudFront에 연결할 ACM 인증서는 반드시 <strong>미국 동부(버지니아) - us-east-1</strong> 리전에서 생성해야 합니다. 서울 리전(ap-northeast-2)에서 생성한 인증서는 CloudFront에 연결할 수 없습니다.</p>
      </div>

      <div class="code-block">
        <div class="code-header">
          <span class="lang">bash</span>
          <button class="copy-btn">복사</button>
        </div>
        <pre><code># ACM 인증서 발급 (us-east-1에서!)
aws acm request-certificate \
  --region us-east-1 \
  --domain-name "shopeasy.example.com" \
  --subject-alternative-names "*.shopeasy.example.com" \
  --validation-method DNS

# DNS 검증 레코드 확인
aws acm describe-certificate \
  --region us-east-1 \
  --certificate-arn "arn:aws:acm:us-east-1:123456789012:certificate/abc-123" \
  --query 'Certificate.DomainValidationOptions[].ResourceRecord'

# CloudFront 배포에 인증서 연결
# 콘솔: 배포 설정 > General > Edit
#   - Alternate domain name: shopeasy.example.com
#   - Custom SSL certificate: ACM 인증서 선택
#   - Security policy: TLSv1.2_2021</code></pre>
      </div>
    </section>

    <!-- Section 6: 보안 헤더 -->
    <section class="content-section" id="security-headers">
      <h2>6. CloudFront 추가 보안 헤더</h2>

      <p>CloudFront의 <strong>응답 헤더 정책(Response Headers Policy)</strong>을 사용하면 브라우저 보안을 강화하는 HTTP 헤더를 추가할 수 있습니다. 오리진 서버를 수정하지 않고도 보안 헤더를 적용할 수 있다는 것이 큰 장점입니다.</p>

      <h3>주요 보안 헤더</h3>

      <table>
        <thead>
          <tr><th>헤더</th><th>역할</th><th>권장 값</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Strict-Transport-Security</code> (HSTS)</td>
            <td>브라우저에 HTTPS만 사용하도록 강제</td>
            <td><code>max-age=63072000; includeSubDomains; preload</code></td>
          </tr>
          <tr>
            <td><code>Content-Security-Policy</code> (CSP)</td>
            <td>XSS, 데이터 주입 공격 방지</td>
            <td>사이트에 맞게 커스터마이즈</td>
          </tr>
          <tr>
            <td><code>X-Content-Type-Options</code></td>
            <td>MIME 스니핑 방지</td>
            <td><code>nosniff</code></td>
          </tr>
          <tr>
            <td><code>X-Frame-Options</code></td>
            <td>클릭재킹 방지 (iframe 삽입 차단)</td>
            <td><code>DENY</code> 또는 <code>SAMEORIGIN</code></td>
          </tr>
          <tr>
            <td><code>X-XSS-Protection</code></td>
            <td>브라우저 XSS 필터 활성화</td>
            <td><code>1; mode=block</code></td>
          </tr>
          <tr>
            <td><code>Referrer-Policy</code></td>
            <td>리퍼러 정보 제어 (정보 노출 방지)</td>
            <td><code>strict-origin-when-cross-origin</code></td>
          </tr>
        </tbody>
      </table>

      <h3>각 보안 헤더 상세 설명</h3>

      <h4>HSTS (HTTP Strict Transport Security)</h4>
      <p>HSTS 헤더가 설정되면 브라우저는 지정된 기간(<code>max-age</code>) 동안 해당 도메인에 HTTP로 접근하지 않고 항상 HTTPS로 접근합니다. 이를 통해 SSL 스트리핑 공격을 방지합니다.</p>

      <div class="code-block">
        <div class="code-header">
          <span class="lang">text</span>
          <button class="copy-btn">복사</button>
        </div>
        <pre><code># HSTS 헤더 예시
Strict-Transport-Security: max-age=63072000; includeSubDomains; preload

# max-age=63072000    : 2년간 HTTPS 강제
# includeSubDomains   : 모든 서브도메인에도 적용
# preload             : 브라우저 HSTS Preload 목록에 등록 가능</code></pre>
      </div>

      <h4>CSP (Content Security Policy)</h4>
      <p>CSP는 브라우저가 로드할 수 있는 리소스의 출처를 제한합니다. XSS 공격의 영향을 크게 줄일 수 있는 강력한 보안 헤더입니다.</p>

      <div class="code-block">
        <div class="code-header">
          <span class="lang">text</span>
          <button class="copy-btn">복사</button>
        </div>
        <pre><code># ShopEasy에 맞는 CSP 헤더 예시
Content-Security-Policy:
  default-src 'self';
  script-src 'self';
  style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
  img-src 'self' data: https://shopeasy-images.s3.amazonaws.com;
  font-src 'self' https://cdn.jsdelivr.net;
  connect-src 'self' https://api.shopeasy.com;
  frame-ancestors 'none';
  base-uri 'self';
  form-action 'self'</code></pre>
      </div>

      <div class="info-box warning">
        <div class="info-box-title">CSP 설정 시 주의</div>
        <p>CSP를 너무 엄격하게 설정하면 사이트가 정상 작동하지 않을 수 있습니다. 먼저 <code>Content-Security-Policy-Report-Only</code> 헤더로 테스트한 후, 문제가 없으면 실제 CSP로 전환하세요. 브라우저 개발자 도구 콘솔에서 CSP 위반 사항을 확인할 수 있습니다.</p>
      </div>

      <h3>응답 헤더 정책 생성 (AWS CLI)</h3>

      <div class="code-block">
        <div class="code-header">
          <span class="lang">bash</span>
          <button class="copy-btn">복사</button>
        </div>
        <pre><code># 커스텀 보안 헤더 정책 생성
aws cloudfront create-response-headers-policy \
  --response-headers-policy-config '{
    "Name": "ShopEasy-Security-Headers",
    "Comment": "ShopEasy 보안 헤더 정책",
    "SecurityHeadersConfig": {
      "StrictTransportSecurity": {
        "Override": true,
        "AccessControlMaxAgeSec": 63072000,
        "IncludeSubdomains": true,
        "Preload": true
      },
      "ContentTypeOptions": {
        "Override": true
      },
      "FrameOptions": {
        "Override": true,
        "FrameOption": "DENY"
      },
      "XSSProtection": {
        "Override": true,
        "Protection": true,
        "ModeBlock": true
      },
      "ReferrerPolicy": {
        "Override": true,
        "ReferrerPolicy": "strict-origin-when-cross-origin"
      }
    }
  }'

# 배포의 Behavior에 정책 연결
# 콘솔: Behaviors > 편집 > Response headers policy 선택</code></pre>
      </div>

      <div class="info-box tip">
        <div class="info-box-title">AWS 관리형 정책 활용</div>
        <p>AWS는 사전 정의된 관리형 응답 헤더 정책을 제공합니다. 콘솔에서 <strong>SecurityHeadersPolicy</strong>를 선택하면 기본 보안 헤더가 자동으로 적용됩니다. CSP 같은 커스터마이즈가 필요한 경우에만 커스텀 정책을 생성하세요.</p>
      </div>
    </section>

    <!-- Lab: OAC 설정 -->
    <section class="content-section" id="lab-oac">
      <h2>7. 실습: OAC 설정으로 S3 직접 접근 차단</h2>

      <div class="lab-section">
        <div class="lab-title">실습: ShopEasy 프론트엔드 S3 버킷에 OAC 적용하기</div>
        <div class="steps">
          <div class="step">
            <div class="step-title">현재 상태 확인 - S3 직접 접근 테스트</div>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code># S3 URL로 직접 접근 (현재는 접근 가능 = 보안 취약)
curl -I https://shopeasy-product-images.s3.ap-northeast-2.amazonaws.com/products/shoe-01.jpg

# CloudFront URL로 접근 (정상 경로)
curl -I https://d1234567890.cloudfront.net/products/shoe-01.jpg</code></pre>
            </div>
          </div>

          <div class="step">
            <div class="step-title">OAC 생성</div>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code># OAC 생성
aws cloudfront create-origin-access-control \
  --origin-access-control-config '{
    "Name": "ShopEasy-S3-OAC",
    "Description": "ShopEasy S3 버킷용 OAC",
    "SigningProtocol": "sigv4",
    "SigningBehavior": "always",
    "OriginAccessControlOriginType": "s3"
  }'

# 생성된 OAC ID 확인
aws cloudfront list-origin-access-controls \
  --query 'OriginAccessControlList.Items[?Name==`ShopEasy-S3-OAC`].Id' \
  --output text</code></pre>
            </div>
          </div>

          <div class="step">
            <div class="step-title">CloudFront 배포에 OAC 연결</div>
            <ul>
              <li>CloudFront 콘솔 > 배포 선택 > <strong>Origins</strong> 탭</li>
              <li>S3 오리진 선택 > <strong>편집</strong></li>
              <li>Origin access: <strong>Origin access control settings (recommended)</strong> 선택</li>
              <li>Origin access control: 생성한 <strong>ShopEasy-S3-OAC</strong> 선택</li>
              <li><strong>S3 버킷 정책 업데이트</strong> 배너에서 정책 복사</li>
            </ul>
          </div>

          <div class="step">
            <div class="step-title">S3 퍼블릭 액세스 차단 + 버킷 정책 업데이트</div>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code># 퍼블릭 액세스 완전 차단
aws s3api put-public-access-block \
  --bucket shopeasy-product-images \
  --public-access-block-configuration '{
    "BlockPublicAcls": true,
    "IgnorePublicAcls": true,
    "BlockPublicPolicy": true,
    "RestrictPublicBuckets": true
  }'

# 버킷 정책 업데이트 (CloudFront만 허용)
aws s3api put-bucket-policy \
  --bucket shopeasy-product-images \
  --policy file://bucket-policy-oac.json</code></pre>
            </div>
          </div>

          <div class="step">
            <div class="step-title">보안 헤더 정책 + HTTPS 강제 설정</div>
            <p>CloudFront 배포의 동작(Behavior) 설정에서:</p>
            <ul>
              <li><strong>뷰어 프로토콜 정책</strong>: Redirect HTTP to HTTPS</li>
              <li><strong>응답 헤더 정책</strong>: SecurityHeadersPolicy (AWS 관리형) 선택</li>
              <li>TLS 최소 버전: <strong>TLSv1.2_2021</strong></li>
            </ul>
          </div>

          <div class="step">
            <div class="step-title">검증</div>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code># 1. S3 직접 접근 차단 확인 (403이어야 함)
curl -I https://shopeasy-product-images.s3.ap-northeast-2.amazonaws.com/products/shoe-01.jpg
# HTTP/1.1 403 Forbidden

# 2. CloudFront를 통한 접근 확인 (200이어야 함)
curl -I https://d1234567890.cloudfront.net/products/shoe-01.jpg
# HTTP/2 200

# 3. 보안 헤더 확인
curl -sI https://d1234567890.cloudfront.net/ | grep -i -E "strict-transport|x-frame|x-content-type|x-xss"
# strict-transport-security: max-age=63072000
# x-frame-options: DENY
# x-content-type-options: nosniff
# x-xss-protection: 1; mode=block

# 4. HTTP -> HTTPS 리다이렉트 확인
curl -I http://d1234567890.cloudfront.net/
# HTTP/1.1 301 Moved Permanently
# Location: https://d1234567890.cloudfront.net/</code></pre>
            </div>

            <div class="info-box best-practice">
              <div class="info-box-title">검증 체크리스트</div>
              <ul>
                <li>S3 URL 직접 접근 시 403 Forbidden 반환</li>
                <li>CloudFront URL로 정상 접근 가능</li>
                <li>HTTP 요청이 HTTPS로 리다이렉트</li>
                <li>응답에 보안 헤더(HSTS, X-Frame-Options 등) 포함</li>
                <li>브라우저에서 ShopEasy 프론트엔드가 정상 작동</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="chapter-nav">
      <a href="13-secrets-manager.html" class="prev">이전: Secrets Manager & Parameter Store</a>
      <a href="15-api-gateway-security.html" class="next">다음: API Gateway 보안</a>
    </div>
  </main>
</div>

<script src="../assets/js/main.js"></script>
</body>

<!-- Mirrored from rapa-aws-security.vercel.app/chapters/14-cloudfront-security.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Feb 2026 08:26:36 GMT -->
</html>
