<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S3 + Lambda 이미지 처리 - AWS 기초 강의</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>

<header class="site-header">
  <div class="header-inner">
    <a href="../index.html" class="header-logo">
      <span class="aws-icon">AWS</span>
      <span>기초 강의</span>
    </a>
  </div>
</header>

<div class="page-layout">
  <nav class="sidebar">
    <ul class="sidebar-nav">
      <li class="sidebar-section">이미지 처리</li>
      <li><a href="#s3-event-trigger">S3 이벤트 트리거</a></li>
      <li><a href="#lambda-layer">Lambda Layer</a></li>
      <li><a href="#image-resize-flow">이미지 리사이징 흐름</a></li>
      <li><a href="#lab">실습</a></li>
    </ul>
  </nav>

  <main class="main-content">
    <div class="chapter-header">
      <span class="chapter-num">Chapter 21</span>
      <h1>S3 + Lambda 이미지 처리</h1>
      <div class="objectives">
        <h3>학습 목표</h3>
        <ul>
          <li>S3 이벤트 트리거의 개념과 동작 방식을 이해한다</li>
          <li>Lambda Layer를 사용하여 외부 라이브러리를 Lambda에 추가할 수 있다</li>
          <li>S3에 이미지가 업로드되면 자동으로 썸네일을 생성하는 Lambda 함수를 구현할 수 있다</li>
          <li>ShopEasy의 리뷰 사진에 대한 자동 썸네일 생성 파이프라인을 구축할 수 있다</li>
        </ul>
      </div>
    </div>

    <!-- Section 1: S3 이벤트 트리거 -->
    <section class="content-section" id="s3-event-trigger">
      <h2>S3 이벤트 트리거란?</h2>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 현관 초인종</div>
        <p>집 현관에 초인종이 있으면, 누가 올 때마다 "딩동!" 소리가 나죠. S3 이벤트 트리거도 같습니다. S3 버킷에 파일이 올라오면(누가 오면) 자동으로 Lambda 함수를 호출합니다(초인종이 울림). 여러분이 계속 "파일 올라왔나?" 하고 확인할 필요 없이, S3가 알아서 알려줍니다.</p>
      </div>

      <h3>S3 이벤트 종류</h3>
      <table>
        <thead>
          <tr><th>이벤트 타입</th><th>발생 시점</th><th>사용 예시</th></tr>
        </thead>
        <tbody>
          <tr><td><code>s3:ObjectCreated:Put</code></td><td>파일이 업로드(PUT)될 때</td><td>이미지 업로드 시 썸네일 생성</td></tr>
          <tr><td><code>s3:ObjectCreated:Post</code></td><td>멀티파트 업로드 완료 시</td><td>대용량 파일 업로드 처리</td></tr>
          <tr><td><code>s3:ObjectCreated:*</code></td><td>모든 생성 이벤트</td><td>모든 업로드에 반응</td></tr>
          <tr><td><code>s3:ObjectRemoved:Delete</code></td><td>파일이 삭제될 때</td><td>관련 데이터 정리</td></tr>
        </tbody>
      </table>

      <h3>이벤트 필터링</h3>
      <p>모든 파일에 대해 트리거하면 비효율적이므로, <strong>접두사(Prefix)</strong>와 <strong>접미사(Suffix)</strong>로 필터링할 수 있습니다.</p>
      <ul>
        <li><strong>접두사</strong>: <code>uploads/</code> → uploads 폴더에 업로드된 파일만</li>
        <li><strong>접미사</strong>: <code>.jpg</code> → JPG 파일만</li>
      </ul>

      <div class="info-box warning">
        <div class="info-box-title">주의: 무한 루프 방지</div>
        <p>Lambda가 같은 버킷에 결과 파일을 저장할 경우, 그 저장이 또 트리거를 발생시켜 <strong>무한 루프</strong>가 될 수 있습니다! 이를 방지하려면:</p>
        <ul>
          <li>원본과 결과를 <strong>다른 접두사</strong>(폴더)에 저장 (예: <code>uploads/</code> → <code>thumbnails/</code>)</li>
          <li>또는 <strong>다른 버킷</strong>에 저장</li>
          <li>트리거의 접두사 필터를 정확하게 설정</li>
        </ul>
      </div>

      <h3>S3 이벤트의 Lambda 전달 형태</h3>
      <p>S3 이벤트가 발생하면 Lambda에 다음과 같은 형태로 데이터가 전달됩니다:</p>
      <div class="code-block">
        <div class="code-header"><span class="lang">json</span><button class="copy-btn">복사</button></div>
        <pre><code>{
    "Records": [
        {
            "eventSource": "aws:s3",
            "eventName": "ObjectCreated:Put",
            "s3": {
                "bucket": {
                    "name": "shopeasy-review-photos"
                },
                "object": {
                    "key": "uploads/review-photo-001.jpg",
                    "size": 2048576
                }
            }
        }
    ]
}</code></pre>
      </div>
    </section>

    <!-- Section 2: Lambda Layer -->
    <section class="content-section" id="lambda-layer">
      <h2>Lambda Layer란?</h2>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 공용 도구함</div>
        <p>사무실에서 여러 팀이 같은 프린터를 공유하는 것처럼, Lambda Layer는 여러 Lambda 함수가 공유하는 <strong>공용 라이브러리 묶음</strong>입니다. 모든 함수에 같은 라이브러리를 각각 넣는 대신, Layer에 한 번만 넣어두면 여러 함수에서 가져다 쓸 수 있습니다.</p>
      </div>

      <h3>왜 Lambda Layer가 필요한가?</h3>
      <p>Lambda 함수 코드에는 <strong>250MB 크기 제한</strong>이 있습니다. 이미지 처리 라이브러리인 <code>sharp</code>는 크기가 상당히 크므로, Layer로 분리하는 것이 효율적입니다.</p>

      <h3>Layer의 장점</h3>
      <ul>
        <li><strong>코드 분리</strong> - 비즈니스 로직과 라이브러리를 분리하여 관리</li>
        <li><strong>재사용</strong> - 여러 함수에서 같은 Layer를 공유</li>
        <li><strong>배포 크기 감소</strong> - 함수 코드만 배포하면 되므로 배포가 빠름</li>
        <li><strong>버전 관리</strong> - Layer에 버전을 매겨 롤백 가능</li>
      </ul>

      <h3>Layer 구조</h3>
      <div class="code-block">
        <div class="code-header"><span class="lang">text</span><button class="copy-btn">복사</button></div>
        <pre><code>layer.zip
└── nodejs/
    └── node_modules/
        └── sharp/
            ├── lib/
            ├── build/
            └── package.json</code></pre>
      </div>

      <div class="info-box concept">
        <div class="info-box-title">핵심: Layer의 경로 규칙</div>
        <p>Node.js 런타임의 경우, Layer의 라이브러리는 반드시 <code>nodejs/node_modules/</code> 경로 안에 있어야 합니다. Lambda가 실행될 때 이 경로를 자동으로 <code>NODE_PATH</code>에 추가합니다.</p>
      </div>
    </section>

    <!-- Section 3: 이미지 리사이징 흐름 -->
    <section class="content-section" id="image-resize-flow">
      <h2>이미지 리사이징 흐름</h2>

      <p>ShopEasy에서 리뷰 사진의 자동 썸네일 생성 흐름은 다음과 같습니다:</p>

      <div class="diagram">
        <div class="diagram-title">이미지 리사이징 파이프라인</div>
        <div class="diagram-col" style="align-items:center;">
          <div class="diagram-box user"><div class="box-title">1. 사용자</div><div class="box-sub">리뷰 사진 업로드</div></div>
          <div class="diagram-arrow down">&darr;</div>
          <div class="diagram-box storage"><div class="box-title">2. S3 버킷</div><div class="box-sub">uploads/ 폴더에 저장</div></div>
          <div class="diagram-arrow down">&darr; S3 이벤트 트리거</div>
          <div class="diagram-box serverless"><div class="box-title">3. Lambda 함수 실행</div><div class="box-sub">S3에서 원본 이미지 다운로드<br>sharp 라이브러리로 300x300 리사이징<br>리사이징된 이미지를 S3에 업로드</div></div>
          <div class="diagram-arrow down">&darr;</div>
          <div class="diagram-box storage"><div class="box-title">4. S3 버킷</div><div class="box-sub">thumbnails/ 폴더에 저장</div></div>
          <div class="diagram-arrow down">&darr;</div>
          <div class="diagram-box user"><div class="box-title">5. 프론트엔드</div><div class="box-sub">썸네일 URL로 표시</div></div>
        </div>
      </div>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 사진관</div>
        <p>여러분이 사진관(S3)에 사진을 맡기면(업로드), 사진관 직원(Lambda)이 자동으로 여권사진 크기(300x300)로 줄여서 별도 앨범(thumbnails/)에 넣어줍니다. 여러분이 직접 포토샵을 열 필요 없이 자동으로!</p>
      </div>

      <h3>sharp 라이브러리란?</h3>
      <p><code>sharp</code>는 Node.js에서 가장 많이 사용되는 고성능 이미지 처리 라이브러리입니다.</p>
      <ul>
        <li>JPEG, PNG, WebP, AVIF 등 다양한 형식 지원</li>
        <li>리사이징, 크롭, 회전, 포맷 변환</li>
        <li>C 라이브러리(libvips) 기반으로 매우 빠름</li>
      </ul>

      <div class="code-block">
        <div class="code-header"><span class="lang">javascript</span><button class="copy-btn">복사</button></div>
        <pre><code>import sharp from 'sharp';

// 이미지를 300x300으로 리사이징
const resizedBuffer = await sharp(originalBuffer)
    .resize(300, 300, {
        fit: 'cover',    // 비율 유지하며 꽉 채움
        position: 'center'  // 중앙 기준 크롭
    })
    .jpeg({ quality: 80 })  // JPEG 80% 품질
    .toBuffer();</code></pre>
      </div>
    </section>

    <!-- Lab Section -->
    <section class="content-section" id="lab">
      <h2>실습</h2>

      <div class="info-box danger">
        <div class="info-box-title">비용 안내</div>
        <p>S3 저장 비용과 Lambda 실행 비용이 발생하지만, 프리티어 범위 내에서 충분합니다. 실습 후 불필요한 테스트 이미지는 삭제하세요.</p>
      </div>

      <div class="lab-section">
        <div class="lab-title">실습: 리뷰 사진 자동 썸네일 생성</div>
        <ol class="steps">

          <!-- Step 1 -->
          <li class="step">
            <div class="step-title">S3 버킷 구조 확인</div>
            <p>이전 챕터에서 만든 리뷰 사진 S3 버킷(<code>shopeasy-review-photos-[계정ID]</code>)을 사용합니다.</p>
            <p>이 버킷에 두 개의 "폴더"(접두사)를 사용합니다:</p>
            <ul>
              <li><code>uploads/</code> - 원본 사진이 업로드되는 곳</li>
              <li><code>thumbnails/</code> - Lambda가 생성한 썸네일이 저장되는 곳</li>
            </ul>
            <p>S3 콘솔에서 버킷을 열고, <strong>Create folder</strong>를 클릭하여 <code>thumbnails</code> 폴더를 만듭니다.</p>
            <div class="screenshot-placeholder">S3 버킷 - thumbnails 폴더 생성</div>
          </li>

          <!-- Step 2 -->
          <li class="step">
            <div class="step-title">sharp Lambda Layer 준비</div>
            <p>sharp 라이브러리는 네이티브 바이너리를 포함하므로, Lambda 실행 환경(Amazon Linux 2)에 맞는 버전을 빌드해야 합니다.</p>
            <p>로컬 컴퓨터(또는 Cloud9)에서 Layer를 만듭니다:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 작업 디렉토리 생성
mkdir -p sharp-layer/nodejs
cd sharp-layer/nodejs

# package.json 생성
npm init -y

# Lambda arm64 환경에 맞는 sharp 설치
npm install --arch=arm64 --platform=linux sharp

# 상위 디렉토리로 이동
cd ..

# ZIP 파일 생성
zip -r sharp-layer.zip nodejs/</code></pre>
            </div>

            <div class="info-box tip">
              <div class="info-box-title">Tip: Docker로 빌드하기 (더 안전한 방법)</div>
              <p>macOS나 Windows에서는 네이티브 라이브러리 호환 문제가 생길 수 있습니다. Docker를 사용하면 확실합니다:</p>
            </div>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># Docker로 Lambda 환경에서 빌드
docker run --rm -v "$PWD":/var/task \
  public.ecr.aws/lambda/nodejs:20-arm64 \
  bash -c "cd /var/task && mkdir -p nodejs && cd nodejs && npm init -y && npm install sharp && cd .. && zip -r sharp-layer.zip nodejs/"</code></pre>
            </div>

            <div class="info-box warning">
              <div class="info-box-title">대안: AWS 공개 Layer 사용</div>
              <p>빌드가 어렵다면, 커뮤니티에서 제공하는 공개 Layer를 사용할 수도 있습니다. 또는 AWS 콘솔에서 직접 Layer를 업로드할 때 50MB 제한이 있으므로, 큰 파일은 S3를 통해 업로드합니다.</p>
            </div>
          </li>

          <!-- Step 3 -->
          <li class="step">
            <div class="step-title">Lambda Layer 업로드</div>
            <p>AWS 콘솔 > <strong>Lambda</strong> > 왼쪽 메뉴 <strong>Layers</strong> > <strong>Create layer</strong>를 클릭합니다.</p>
            <ul>
              <li><strong>Name</strong>: <code>sharp-layer</code></li>
              <li><strong>Upload</strong>: 앞에서 만든 <code>sharp-layer.zip</code> 파일 업로드</li>
              <li>만약 파일이 50MB 이상이면 S3에 먼저 업로드한 후 S3 URL을 입력</li>
              <li><strong>Compatible runtimes</strong>: <code>Node.js 20.x</code> 선택</li>
              <li><strong>Compatible architectures</strong>: <code>arm64</code> 선택</li>
            </ul>
            <p><strong>Create</strong>를 클릭합니다.</p>
            <div class="screenshot-placeholder">Lambda Layer 생성 화면</div>
          </li>

          <!-- Step 4 -->
          <li class="step">
            <div class="step-title">Lambda 함수 생성</div>
            <p><strong>Lambda</strong> > <strong>Functions</strong> > <strong>Create function</strong>을 클릭합니다.</p>
            <ul>
              <li><strong>Function name</strong>: <code>shopeasy-image-resize</code></li>
              <li><strong>Runtime</strong>: <code>Node.js 20.x</code></li>
              <li><strong>Architecture</strong>: <code>arm64</code></li>
              <li><strong>Execution role</strong>: <code>Create a new role with basic Lambda permissions</code></li>
            </ul>
            <p><strong>Create function</strong>을 클릭합니다.</p>
            <div class="screenshot-placeholder">이미지 리사이징 Lambda 함수 생성</div>
          </li>

          <!-- Step 5 -->
          <li class="step">
            <div class="step-title">Layer 추가</div>
            <p>함수 상세 페이지 하단의 <strong>Layers</strong> 섹션에서 <strong>Add a layer</strong>를 클릭합니다.</p>
            <ul>
              <li><strong>Layer source</strong>: <code>Custom layers</code> 선택</li>
              <li><strong>Custom layers</strong>: 드롭다운에서 <code>sharp-layer</code> 선택</li>
              <li><strong>Version</strong>: <code>1</code></li>
            </ul>
            <p><strong>Add</strong>를 클릭합니다.</p>
            <div class="screenshot-placeholder">Lambda 함수에 Layer 추가 화면</div>
          </li>

          <!-- Step 6 -->
          <li class="step">
            <div class="step-title">IAM 역할에 S3 권한 추가</div>
            <p>Lambda 함수가 S3에서 이미지를 읽고 썸네일을 저장하려면 S3 권한이 필요합니다.</p>
            <p><strong>Configuration</strong> 탭 > <strong>Permissions</strong>를 클릭합니다.</p>
            <p><strong>Execution role</strong>의 역할 이름을 클릭하면 IAM 콘솔로 이동합니다.</p>
            <p><strong>Add permissions</strong> > <strong>Attach policies</strong>를 클릭합니다.</p>
            <p><code>AmazonS3FullAccess</code>를 검색하여 선택하고 <strong>Attach policies</strong>를 클릭합니다.</p>
            <div class="screenshot-placeholder">IAM 역할에 S3 권한 추가</div>

            <div class="info-box tip">
              <div class="info-box-title">Tip: 실무에서는 최소 권한으로</div>
              <p>실습에서는 <code>AmazonS3FullAccess</code>를 사용하지만, 실무에서는 특정 버킷에만 접근하는 커스텀 정책을 만들어야 합니다:</p>
            </div>
            <div class="code-block">
              <div class="code-header"><span class="lang">json</span><button class="copy-btn">복사</button></div>
              <pre><code>{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": ["s3:GetObject"],
            "Resource": "arn:aws:s3:::shopeasy-review-photos-*/uploads/*"
        },
        {
            "Effect": "Allow",
            "Action": ["s3:PutObject"],
            "Resource": "arn:aws:s3:::shopeasy-review-photos-*/thumbnails/*"
        }
    ]
}</code></pre>
            </div>
          </li>

          <!-- Step 7 -->
          <li class="step">
            <div class="step-title">이미지 리사이징 코드 작성</div>
            <p>Lambda 함수의 코드 편집기에서 <code>index.mjs</code>를 다음 코드로 교체합니다:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">javascript</span><button class="copy-btn">복사</button></div>
              <pre><code>import { S3Client, GetObjectCommand, PutObjectCommand } from '@aws-sdk/client-s3';
import sharp from 'sharp';

const s3Client = new S3Client();

// 썸네일 크기 설정
const THUMBNAIL_WIDTH = 300;
const THUMBNAIL_HEIGHT = 300;

export const handler = async (event) => {
    console.log("이벤트 수신:", JSON.stringify(event, null, 2));

    // S3 이벤트에서 버킷 이름과 파일 키 추출
    const record = event.Records[0];
    const bucketName = record.s3.bucket.name;
    const sourceKey = decodeURIComponent(
        record.s3.object.key.replace(/\+/g, ' ')
    );

    console.log(`버킷: ${bucketName}, 원본 파일: ${sourceKey}`);

    // 썸네일 저장 경로 생성 (uploads/ → thumbnails/)
    const thumbnailKey = sourceKey.replace('uploads/', 'thumbnails/');
    console.log(`썸네일 저장 경로: ${thumbnailKey}`);

    try {
        // 1. S3에서 원본 이미지 가져오기
        console.log("원본 이미지 다운로드 중...");
        const getCommand = new GetObjectCommand({
            Bucket: bucketName,
            Key: sourceKey
        });
        const originalImage = await s3Client.send(getCommand);

        // 스트림을 버퍼로 변환
        const chunks = [];
        for await (const chunk of originalImage.Body) {
            chunks.push(chunk);
        }
        const imageBuffer = Buffer.concat(chunks);
        console.log(`원본 이미지 크기: ${imageBuffer.length} bytes`);

        // 2. sharp로 이미지 리사이징
        console.log(`리사이징 중... (${THUMBNAIL_WIDTH}x${THUMBNAIL_HEIGHT})`);
        const thumbnailBuffer = await sharp(imageBuffer)
            .resize(THUMBNAIL_WIDTH, THUMBNAIL_HEIGHT, {
                fit: 'cover',
                position: 'center'
            })
            .jpeg({ quality: 80 })
            .toBuffer();
        console.log(`썸네일 크기: ${thumbnailBuffer.length} bytes`);

        // 3. 썸네일을 S3에 저장
        console.log("썸네일 업로드 중...");
        const putCommand = new PutObjectCommand({
            Bucket: bucketName,
            Key: thumbnailKey,
            Body: thumbnailBuffer,
            ContentType: 'image/jpeg'
        });
        await s3Client.send(putCommand);

        console.log("썸네일 생성 완료!");
        const compressionRatio = ((1 - thumbnailBuffer.length / imageBuffer.length) * 100).toFixed(1);
        console.log(`압축률: ${compressionRatio}% 감소`);

        return {
            statusCode: 200,
            body: JSON.stringify({
                message: '썸네일 생성 완료',
                original: sourceKey,
                thumbnail: thumbnailKey,
                originalSize: imageBuffer.length,
                thumbnailSize: thumbnailBuffer.length
            })
        };
    } catch (error) {
        console.error("에러 발생:", error);
        throw error;
    }
};</code></pre>
            </div>
            <p><strong>Deploy</strong>를 클릭하여 저장합니다.</p>
          </li>

          <!-- Step 8 -->
          <li class="step">
            <div class="step-title">메모리 및 타임아웃 설정</div>
            <p>이미지 처리는 메모리와 시간이 더 필요합니다.</p>
            <p><strong>Configuration</strong> > <strong>General configuration</strong> > <strong>Edit</strong></p>
            <ul>
              <li><strong>Memory</strong>: <code>512 MB</code> (이미지 처리에 필요)</li>
              <li><strong>Timeout</strong>: <code>30초</code> (큰 이미지 처리 대비)</li>
            </ul>
            <p><strong>Save</strong>를 클릭합니다.</p>
            <div class="screenshot-placeholder">메모리 512MB, 타임아웃 30초 설정</div>
          </li>

          <!-- Step 9 -->
          <li class="step">
            <div class="step-title">S3 이벤트 트리거 설정</div>
            <p>Lambda 함수 상세 페이지에서 <strong>Add trigger</strong>를 클릭합니다.</p>
            <ul>
              <li><strong>Trigger configuration</strong>: <code>S3</code> 선택</li>
              <li><strong>Bucket</strong>: <code>shopeasy-review-photos-[계정ID]</code> 선택</li>
              <li><strong>Event types</strong>: <code>All object create events</code> (s3:ObjectCreated:*)</li>
              <li><strong>Prefix</strong>: <code>uploads/</code> (uploads 폴더만 트리거)</li>
              <li><strong>Suffix</strong>: <code>.jpg</code> (JPG 파일만 - 추가로 .png, .jpeg도 별도 트리거 생성 가능)</li>
            </ul>
            <p><strong>Recursive invocation</strong> 체크박스에 체크합니다 (무한 루프가 아님을 확인).</p>
            <p><strong>Add</strong>를 클릭합니다.</p>
            <div class="screenshot-placeholder">S3 이벤트 트리거 설정 화면</div>

            <div class="info-box concept">
              <div class="info-box-title">무한 루프 방지 확인</div>
              <p>우리 설정에서는 트리거가 <code>uploads/</code> 접두사에만 반응하고, 썸네일은 <code>thumbnails/</code>에 저장하므로 무한 루프가 발생하지 않습니다.</p>
            </div>
          </li>

          <!-- Step 10 -->
          <li class="step">
            <div class="step-title">테스트: 이미지 업로드 및 썸네일 확인</div>
            <p>먼저 테스트용 이미지를 S3에 업로드합니다.</p>

            <h4>방법 1: AWS CLI로 업로드</h4>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 테스트 이미지를 S3의 uploads/ 폴더에 업로드
aws s3 cp test-photo.jpg s3://shopeasy-review-photos-[계정ID]/uploads/test-photo.jpg</code></pre>
            </div>

            <h4>방법 2: AWS 콘솔에서 업로드</h4>
            <p>S3 콘솔 > 버킷 > <code>uploads/</code> 폴더 > <strong>Upload</strong> > 이미지 파일 선택 > <strong>Upload</strong></p>

            <p>약 몇 초 후, <code>thumbnails/</code> 폴더에 같은 이름의 썸네일이 생성되었는지 확인합니다:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 썸네일 확인
aws s3 ls s3://shopeasy-review-photos-[계정ID]/thumbnails/

# 결과 예시:
# 2024-01-15 14:30:00      25600 test-photo.jpg</code></pre>
            </div>
            <div class="screenshot-placeholder">S3 thumbnails/ 폴더에 생성된 썸네일</div>
          </li>

          <!-- Step 11 -->
          <li class="step">
            <div class="step-title">CloudWatch Logs에서 실행 로그 확인</div>
            <p><strong>Lambda</strong> > <strong>Monitor</strong> > <strong>View CloudWatch logs</strong>를 클릭합니다.</p>
            <p>최신 로그 스트림에서 다음 내용을 확인합니다:</p>
            <ul>
              <li>이벤트 수신 정보 (버킷 이름, 파일 키)</li>
              <li>원본 이미지 크기</li>
              <li>리사이징 진행 상황</li>
              <li>썸네일 크기 및 압축률</li>
              <li>실행 시간 및 메모리 사용량</li>
            </ul>
            <div class="screenshot-placeholder">CloudWatch Logs - 이미지 리사이징 로그</div>
          </li>

          <!-- Step 12 -->
          <li class="step">
            <div class="step-title">브라우저에서 리뷰 사진 업로드 테스트</div>
            <p>ShopEasy 웹사이트(CloudFront URL)에서 실제로 리뷰를 작성하면서 사진을 업로드합니다:</p>
            <ol>
              <li>상품 상세 페이지로 이동</li>
              <li>리뷰 작성 클릭</li>
              <li>사진 첨부하여 리뷰 등록</li>
              <li>S3 콘솔에서 <code>uploads/</code>에 원본, <code>thumbnails/</code>에 썸네일이 모두 있는지 확인</li>
            </ol>
            <div class="screenshot-placeholder">ShopEasy 리뷰 작성 - 사진 업로드 후 썸네일 자동 생성 확인</div>

            <div class="info-box tip">
              <div class="info-box-title">Tip: 프론트엔드에서 썸네일 활용</div>
              <p>리뷰 목록에서는 원본 대신 썸네일 URL을 사용하면 페이지 로딩 속도가 크게 향상됩니다. 원본은 사용자가 클릭했을 때만 보여주면 됩니다. API 서버에서 리뷰 사진 URL을 반환할 때 원본 URL과 썸네일 URL을 함께 제공하면 됩니다.</p>
            </div>
          </li>

        </ol>
      </div>

      <div class="info-box concept">
        <div class="info-box-title">정리: 이벤트 기반 아키텍처</div>
        <p>이번 실습에서 구현한 것은 <strong>이벤트 기반 아키텍처</strong>의 전형적인 패턴입니다. "파일이 업로드되면 → 자동으로 처리한다"는 방식은 서버리스의 핵심입니다. API 서버가 이미지를 직접 처리하지 않으므로 API 서버의 부하가 줄어들고, Lambda가 자동 확장되므로 사진이 한 번에 100장이 올라와도 동시에 처리됩니다.</p>
      </div>
    </section>

    <div class="chapter-nav">
      <a href="20-lambda-basics.html" class="prev">이전: Lambda 기초</a>
      <a href="22-api-gateway-lambda.html" class="next">다음: API Gateway + Lambda</a>
    </div>
  </main>
</div>

<script src="../assets/js/main.js"></script>
</body>

</html>
