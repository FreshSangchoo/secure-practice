<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ALB (Application Load Balancer) - AWS 기초 강의</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>

<header class="site-header">
  <div class="header-inner">
    <a href="../index.html" class="header-logo">
      <span class="aws-icon">AWS</span>
      <span>기초 강의</span>
    </a>
  </div>
</header>

<div class="page-layout">
  <nav class="sidebar">
    <ul class="sidebar-nav">
      <li><a href="#what-is-lb">로드밸런서란?</a></li>
      <li><a href="#lb-types">ALB vs NLB vs CLB</a></li>
      <li><a href="#alb-components">ALB 구성 요소</a></li>
      <li><a href="#path-routing">경로 기반 라우팅</a></li>
      <li><a href="#lab">실습</a></li>
    </ul>
  </nav>

  <main class="main-content">
    <div class="chapter-header">
      <span class="chapter-num">Chapter 11</span>
      <h1>ALB (Application Load Balancer)</h1>
      <div class="objectives">
        <h3>학습 목표</h3>
        <ul>
          <li>로드밸런서의 필요성과 동작 원리를 이해한다</li>
          <li>ALB의 구성 요소(리스너, 대상 그룹, 헬스체크)를 파악한다</li>
          <li>ALB를 생성하여 API 서버에 트래픽을 분배한다</li>
          <li>헬스체크와 장애 시 자동 라우팅을 확인한다</li>
        </ul>
      </div>
    </div>

    <!-- Section 1: 로드밸런서란? -->
    <section class="content-section" id="what-is-lb">
      <h2>로드밸런서란?</h2>

      <div class="info-box analogy">
        <div class="info-box-title">비유로 이해하기: 놀이공원 줄서기 안내원</div>
        <p>놀이공원에서 인기 놀이기구에 줄이 길어지면 어떻게 할까요? <strong>안내원이 여러 줄로 분산</strong>시킵니다. "이쪽 줄이 짧으니 여기로 가세요!" 하면서요. 로드밸런서는 바로 이 안내원 역할을 합니다. 수많은 사용자 요청을 여러 서버에 골고루 분배해서, 한 서버에 과부하가 걸리지 않도록 합니다.</p>
      </div>

      <h3>왜 로드밸런서가 필요한가?</h3>
      <p>현재 우리의 ShopEasy는 API 서버가 1대입니다. 만약 이 서버에 문제가 생기면?</p>
      <ul>
        <li><strong>가용성 문제</strong>: 서버 1대가 죽으면 전체 서비스가 중단됩니다</li>
        <li><strong>성능 한계</strong>: 사용자가 늘어나면 1대로는 감당이 안 됩니다</li>
        <li><strong>배포 중단</strong>: 새 버전 배포 시 서비스가 잠시 중단됩니다</li>
      </ul>

      <p>로드밸런서를 사용하면:</p>
      <ul>
        <li><strong>고가용성</strong>: 서버 1대가 죽어도 나머지가 요청을 처리</li>
        <li><strong>수평 확장</strong>: 서버를 추가하기만 하면 처리 능력 증가</li>
        <li><strong>무중단 배포</strong>: 서버를 하나씩 교체하면서 배포 가능</li>
        <li><strong>단일 진입점</strong>: 사용자는 ALB의 DNS 하나만 알면 됨</li>
      </ul>

      <div class="diagram">
        <div class="diagram-title">로드밸런서 동작 원리</div>
        <div class="diagram-row">
          <div class="diagram-box user"><div class="box-title">사용자</div></div>
        </div>
        <div class="diagram-arrow down">↓</div>
        <div class="diagram-row">
          <div class="diagram-box network"><div class="box-title">ALB</div><div class="box-sub">단일 진입점</div></div>
        </div>
        <div class="diagram-arrow down">↓</div>
        <div class="diagram-row">
          <div class="diagram-box compute"><div class="box-title">서버 1</div><div class="box-sub">정상</div></div>
          <div class="diagram-box compute"><div class="box-title">서버 2</div><div class="box-sub">정상</div></div>
          <div class="diagram-box compute" style="opacity:0.5"><div class="box-title">서버 3</div><div class="box-sub">장애</div></div>
        </div>
        <div style="text-align:center; padding:0.5rem; color:var(--text-secondary); font-size:0.9rem;">ALB가 자동으로 정상 서버에만 분배</div>
      </div>
    </section>

    <!-- Section 2: ALB vs NLB vs CLB -->
    <section class="content-section" id="lb-types">
      <h2>ALB vs NLB vs CLB</h2>

      <p>AWS에는 3가지 종류의 로드밸런서가 있습니다:</p>

      <table>
        <thead>
          <tr><th>구분</th><th>ALB (Application)</th><th>NLB (Network)</th><th>CLB (Classic)</th></tr>
        </thead>
        <tbody>
          <tr><td><strong>계층</strong></td><td>Layer 7 (HTTP/HTTPS)</td><td>Layer 4 (TCP/UDP)</td><td>Layer 4 + 7</td></tr>
          <tr><td><strong>용도</strong></td><td>웹 애플리케이션</td><td>고성능, 실시간</td><td>레거시 (사용 비권장)</td></tr>
          <tr><td><strong>특징</strong></td><td>경로/호스트 기반 라우팅</td><td>초저지연, 고정 IP</td><td>단순한 분배</td></tr>
          <tr><td><strong>적합한 경우</strong></td><td>REST API, 웹사이트</td><td>게임, IoT, 금융</td><td>-</td></tr>
        </tbody>
      </table>

      <div class="info-box analogy">
        <div class="info-box-title">비유로 이해하기: 택배 분류</div>
        <p><strong>ALB</strong>는 택배 상자를 열어서 내용물(HTTP 요청 경로)을 확인하고 "이건 식품 창고로, 이건 전자제품 창고로" 분류하는 <strong>꼼꼼한 분류원</strong>입니다. <strong>NLB</strong>는 상자를 열지 않고 주소(IP/포트)만 보고 초고속으로 분류하는 <strong>컨베이어 벨트</strong>입니다. 우리의 ShopEasy는 HTTP 웹 앱이므로 <strong>ALB</strong>를 사용합니다.</p>
      </div>

      <div class="info-box concept">
        <div class="info-box-title">왜 ALB를 선택하나요?</div>
        <p>ShopEasy는 REST API 기반의 웹 애플리케이션입니다. ALB는 HTTP 요청의 경로를 보고 <code>/api/*</code>는 API 서버로, <code>/</code>는 프론트엔드로 보내는 <strong>경로 기반 라우팅</strong>이 가능합니다. 이는 NLB에서는 할 수 없는 기능입니다.</p>
      </div>
    </section>

    <!-- Section 3: ALB 구성 요소 -->
    <section class="content-section" id="alb-components">
      <h2>ALB 구성 요소</h2>

      <h3>1. 리스너 (Listener)</h3>
      <p>ALB가 어떤 포트/프로토콜로 요청을 받을지 정의합니다. 예를 들어 HTTP:80으로 들어오는 요청을 수신합니다.</p>

      <h3>2. 대상 그룹 (Target Group)</h3>
      <p>요청을 전달할 서버(EC2 인스턴스)들의 그룹입니다. ALB는 대상 그룹에 등록된 서버들에게 트래픽을 분배합니다.</p>

      <h3>3. 헬스체크 (Health Check)</h3>
      <p>ALB가 주기적으로 각 서버에 "너 살아있니?" 확인 요청을 보냅니다. 응답이 없으면 해당 서버에 트래픽을 보내지 않습니다.</p>

      <div class="info-box analogy">
        <div class="info-box-title">비유로 이해하기: 식당 관리</div>
        <p><strong>리스너</strong>는 식당 입구에서 "어서오세요~" 하는 <strong>안내 직원</strong>입니다. <strong>대상 그룹</strong>은 주방에서 요리하는 <strong>셰프팀</strong>이고요. <strong>헬스체크</strong>는 매니저가 "3번 셰프, 오늘 컨디션 괜찮아요?" 하고 <strong>주기적으로 확인</strong>하는 것입니다. 아프면 그 셰프에게 주문을 넘기지 않죠.</p>
      </div>

      <div class="diagram">
        <div class="diagram-title">ALB 구성 요소</div>
        <div class="diagram-row">
          <div class="diagram-box user"><div class="box-title">사용자 요청</div><div class="box-sub">HTTP:80</div></div>
        </div>
        <div class="diagram-arrow down">↓</div>
        <div class="diagram-row">
          <div class="diagram-box network"><div class="box-title">ALB 리스너</div><div class="box-sub">HTTP 80번 포트로 들어오는 요청을 받겠다</div></div>
        </div>
        <div class="diagram-arrow down">↓</div>
        <div class="diagram-row">
          <div class="diagram-box network"><div class="box-title">리스너 규칙</div><div class="box-sub">경로에 따라 어디로 보낼지 결정</div></div>
        </div>
        <div class="diagram-arrow down">↓</div>
        <div class="diagram-row">
          <div class="diagram-box network"><div class="box-title">대상 그룹</div><div class="box-sub">이 서버들에게 분배하겠다</div></div>
        </div>
        <div class="diagram-arrow down">↓</div>
        <div class="diagram-row">
          <div class="diagram-box compute"><div class="box-title">EC2-1</div><div class="box-sub">정상 (헬스체크)</div></div>
          <div class="diagram-box compute"><div class="box-title">EC2-2</div><div class="box-sub">정상 (헬스체크)</div></div>
        </div>
      </div>

      <h3>헬스체크 설정 항목</h3>
      <table>
        <thead>
          <tr><th>설정</th><th>설명</th><th>기본값</th></tr>
        </thead>
        <tbody>
          <tr><td>Protocol</td><td>헬스체크 프로토콜</td><td>HTTP</td></tr>
          <tr><td>Path</td><td>헬스체크 요청 경로</td><td>/</td></tr>
          <tr><td>Healthy threshold</td><td>정상 판단 연속 성공 횟수</td><td>5회</td></tr>
          <tr><td>Unhealthy threshold</td><td>비정상 판단 연속 실패 횟수</td><td>2회</td></tr>
          <tr><td>Timeout</td><td>응답 대기 시간</td><td>5초</td></tr>
          <tr><td>Interval</td><td>헬스체크 간격</td><td>30초</td></tr>
        </tbody>
      </table>
    </section>

    <!-- Section 4: 경로 기반 라우팅 -->
    <section class="content-section" id="path-routing">
      <h2>경로 기반 라우팅</h2>

      <p>ALB의 가장 강력한 기능 중 하나는 <strong>경로 기반 라우팅(Path-based Routing)</strong>입니다. URL 경로에 따라 다른 서버 그룹으로 요청을 보낼 수 있습니다.</p>

      <div class="diagram">
        <div class="diagram-title">경로 기반 라우팅</div>
        <div class="diagram-row">
          <div class="diagram-box user"><div class="box-title">사용자 요청</div></div>
        </div>
        <div class="diagram-arrow down">↓</div>
        <div class="diagram-row">
          <div class="diagram-box network"><div class="box-title">ALB</div></div>
        </div>
        <div class="diagram-arrow down">↓</div>
        <div class="diagram-row">
          <div class="diagram-col" style="flex:1">
            <div style="text-align:center; font-weight:600; padding:0.3rem; font-size:0.85rem">/api/*</div>
            <div class="diagram-arrow down">↓</div>
            <div class="diagram-box compute"><div class="box-title">API 서버 대상 그룹</div><div class="box-sub">EC2-API-1, EC2-API-2</div></div>
          </div>
          <div class="diagram-col" style="flex:1">
            <div style="text-align:center; font-weight:600; padding:0.3rem; font-size:0.85rem">/admin/*</div>
            <div class="diagram-arrow down">↓</div>
            <div class="diagram-box compute"><div class="box-title">관리자 서버 대상 그룹</div><div class="box-sub">EC2-Admin</div></div>
          </div>
          <div class="diagram-col" style="flex:1">
            <div style="text-align:center; font-weight:600; padding:0.3rem; font-size:0.85rem">/*</div>
            <div class="diagram-arrow down">↓</div>
            <div class="diagram-box compute"><div class="box-title">프론트엔드 대상 그룹</div><div class="box-sub">EC2-Front-1</div></div>
          </div>
        </div>
      </div>

      <div class="info-box analogy">
        <div class="info-box-title">비유로 이해하기: 백화점 안내 데스크</div>
        <p>백화점에 들어가면 안내 데스크가 있죠. "식당은 몇 층이에요?" → "6층으로 가세요." "화장품은?" → "1층이요." 이처럼 ALB는 요청의 URL 경로를 보고 적절한 서버 그룹으로 안내합니다.</p>
      </div>

      <div class="info-box tip">
        <div class="info-box-title">우리 실습에서는?</div>
        <p>이번 실습에서는 API 서버만 ALB 뒤에 두는 단순한 구성을 합니다. 프론트엔드는 추후 Chapter 18에서 S3 정적 호스팅으로 이전할 예정이므로, ALB에는 API 서버만 등록합니다.</p>
      </div>
    </section>

    <!-- Lab Section -->
    <section class="content-section" id="lab">
      <h2>실습</h2>

      <div class="lab-section">
        <div class="lab-title">실습: ALB로 API 서버 트래픽 분배하기</div>

        <div class="info-box danger">
          <div class="info-box-title">비용 주의</div>
          <p><strong>ALB</strong>는 시간당 약 $0.0225의 비용이 발생합니다 (월 약 $16). 실습이 끝나면 삭제하거나, 다음 챕터(Auto Scaling)를 바로 이어서 진행하세요.</p>
        </div>

        <ol class="steps">
          <!-- Step 1 -->
          <li class="step">
            <div class="step-title">API 서버 EC2 2대 준비</div>
            <p>ALB가 트래픽을 분배하려면 대상 서버가 2대 이상 필요합니다. Chapter 10에서 만든 API 서버 EC2를 1대 더 생성합니다.</p>
            <p><strong>AWS 콘솔 &rarr; EC2 &rarr; Instances</strong>에서 기존 <code>ShopEasy-API</code> 인스턴스를 선택합니다.</p>
            <p><strong>Actions &rarr; Image and templates &rarr; Launch more like this</strong> 클릭</p>
            <ul>
              <li><strong>Name</strong>: <code>ShopEasy-API-2</code>로 변경</li>
              <li><strong>Subnet</strong>: <code>private-subnet-a</code> (같은 서브넷) 또는 다른 AZ의 프라이빗 서브넷</li>
              <li>나머지 설정은 동일하게 유지</li>
            </ul>
            <p><strong>Launch instance</strong> 클릭</p>

            <div class="info-box tip">
              <div class="info-box-title">고가용성을 위한 Multi-AZ</div>
              <p>실무에서는 2대의 서버를 <strong>서로 다른 가용영역(AZ)</strong>에 배치합니다. 한 AZ가 장애나도 다른 AZ의 서버가 요청을 처리할 수 있기 때문입니다. 프라이빗 서브넷을 2개 AZ에 만들어두었다면 각각 하나씩 배치하세요.</p>
            </div>

            <p>새 인스턴스에도 동일하게 API 서버를 배포합니다 (Bastion Host 경유 SSH 접속 후):</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># ShopEasy-API-2에 SSH 접속 후 동일하게 설정
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo dnf install -y nodejs git
git clone https://github.com/your-repo/ecommerce-app.git
cd ecommerce-app/api-server
npm install
cat > .env &lt;&lt;'EOF'
PORT=5000
DB_TYPE=sqlite
NODE_ENV=production
EOF
sudo npm install -g pm2
pm2 start npm --name "shopeasy-api" -- start
pm2 startup
pm2 save</code></pre>
            </div>
            <div class="screenshot-placeholder">[스크린샷: EC2 인스턴스 목록 - API 서버 2대 확인]</div>
          </li>

          <!-- Step 2 -->
          <li class="step">
            <div class="step-title">대상 그룹 생성</div>
            <p><strong>AWS 콘솔 &rarr; EC2 &rarr; 왼쪽 메뉴 Load Balancing &rarr; Target Groups &rarr; Create target group</strong></p>

            <h4>Step 1: 기본 설정</h4>
            <ul>
              <li><strong>Choose a target type</strong>: <code>Instances</code></li>
              <li><strong>Target group name</strong>: <code>tg-shopeasy-api</code></li>
              <li><strong>Protocol</strong>: HTTP</li>
              <li><strong>Port</strong>: <code>5000</code></li>
              <li><strong>VPC</strong>: <code>my-vpc</code></li>
              <li><strong>Protocol version</strong>: HTTP1</li>
            </ul>

            <h4>Health checks 설정</h4>
            <ul>
              <li><strong>Health check protocol</strong>: HTTP</li>
              <li><strong>Health check path</strong>: <code>/api/products</code></li>
            </ul>
            <p><strong>Advanced health check settings</strong> 펼치기:</p>
            <ul>
              <li><strong>Healthy threshold</strong>: 3</li>
              <li><strong>Unhealthy threshold</strong>: 2</li>
              <li><strong>Timeout</strong>: 5초</li>
              <li><strong>Interval</strong>: 10초</li>
              <li><strong>Success codes</strong>: 200</li>
            </ul>
            <p><strong>Next</strong> 클릭</p>
            <div class="screenshot-placeholder">[스크린샷: 대상 그룹 생성 - 기본 설정]</div>

            <h4>Step 2: 대상 등록</h4>
            <ul>
              <li><code>ShopEasy-API</code>와 <code>ShopEasy-API-2</code> 체크</li>
              <li><strong>Ports for the selected instances</strong>: <code>5000</code></li>
              <li><strong>Include as pending below</strong> 클릭</li>
            </ul>
            <p>아래 "Review targets"에 2개의 인스턴스가 보이면 <strong>Create target group</strong> 클릭</p>
            <div class="screenshot-placeholder">[스크린샷: 대상 그룹 - API EC2 2대 등록]</div>
          </li>

          <!-- Step 3 -->
          <li class="step">
            <div class="step-title">ALB 생성</div>
            <p><strong>AWS 콘솔 &rarr; EC2 &rarr; 왼쪽 메뉴 Load Balancing &rarr; Load Balancers &rarr; Create load balancer</strong></p>
            <p><strong>Application Load Balancer</strong>의 <strong>Create</strong> 클릭</p>

            <h4>기본 설정</h4>
            <ul>
              <li><strong>Load balancer name</strong>: <code>alb-shopeasy</code></li>
              <li><strong>Scheme</strong>: <code>Internet-facing</code> (인터넷에서 접근 가능)</li>
              <li><strong>IP address type</strong>: IPv4</li>
            </ul>

            <h4>Network mapping</h4>
            <ul>
              <li><strong>VPC</strong>: <code>my-vpc</code></li>
              <li><strong>Mappings</strong>: 최소 2개 AZ 선택 필요
                <ul>
                  <li>ap-northeast-2a: <code>public-subnet-a</code></li>
                  <li>ap-northeast-2c: <code>public-subnet-c</code> (퍼블릭 서브넷이 2개 필요)</li>
                </ul>
              </li>
            </ul>

            <div class="info-box warning">
              <div class="info-box-title">퍼블릭 서브넷이 1개뿐이라면?</div>
              <p>ALB는 최소 2개 AZ에 퍼블릭 서브넷이 필요합니다. 다른 AZ에 퍼블릭 서브넷을 하나 더 생성하세요. <strong>VPC &rarr; Subnets &rarr; Create subnet</strong>에서 다른 AZ에 <code>public-subnet-c</code> (10.0.3.0/24)를 만들고, 퍼블릭 라우팅 테이블에 연결하세요.</p>
            </div>

            <h4>Security groups</h4>
            <p>ALB용 보안그룹을 생성합니다:</p>
            <ul>
              <li><strong>Create new security group</strong> 클릭 (새 탭이 열림)</li>
              <li><strong>Name</strong>: <code>sg-alb</code></li>
              <li><strong>VPC</strong>: <code>my-vpc</code></li>
              <li><strong>Inbound</strong>: HTTP(80) - 0.0.0.0/0</li>
              <li>생성 후 ALB 화면으로 돌아와서 <code>sg-alb</code> 선택</li>
            </ul>

            <h4>Listeners and routing</h4>
            <ul>
              <li><strong>Listener</strong>: HTTP : 80</li>
              <li><strong>Default action</strong>: Forward to <code>tg-shopeasy-api</code></li>
            </ul>

            <p><strong>Create load balancer</strong> 클릭</p>
            <div class="screenshot-placeholder">[스크린샷: ALB 생성 설정 화면]</div>
          </li>

          <!-- Step 4 -->
          <li class="step">
            <div class="step-title">API 서버 보안그룹 수정 (ALB에서 접근 허용)</div>
            <p>현재 API 서버의 보안그룹(<code>sg-api</code>)은 프론트엔드 보안그룹에서만 접근을 허용합니다. ALB에서도 접근할 수 있도록 규칙을 추가합니다.</p>
            <p><strong>AWS 콘솔 &rarr; VPC &rarr; Security Groups &rarr; sg-api &rarr; Edit inbound rules</strong></p>
            <p><strong>Add rule</strong>:</p>
            <table>
              <thead>
                <tr><th>Type</th><th>Port</th><th>Source</th><th>설명</th></tr>
              </thead>
              <tbody>
                <tr><td>Custom TCP</td><td>5000</td><td><strong>sg-alb</strong> (ALB 보안그룹)</td><td>ALB에서 API 서버 접근</td></tr>
              </tbody>
            </table>
            <p><strong>Save rules</strong> 클릭</p>

            <div class="info-box concept">
              <div class="info-box-title">보안그룹 체이닝 확장</div>
              <p>이제 API 서버 보안그룹에는 두 가지 소스가 있습니다: (1) 프론트엔드 보안그룹, (2) ALB 보안그룹. 이것이 바로 보안그룹 체이닝의 장점입니다. IP가 아닌 역할로 접근을 관리합니다.</p>
            </div>
          </li>

          <!-- Step 5 -->
          <li class="step">
            <div class="step-title">헬스체크 확인</div>
            <p>ALB 생성 후 몇 분이 지나면 대상 그룹의 헬스체크 상태를 확인할 수 있습니다.</p>
            <p><strong>AWS 콘솔 &rarr; EC2 &rarr; Target Groups &rarr; tg-shopeasy-api &rarr; Targets 탭</strong></p>
            <ul>
              <li><strong>Status</strong>가 <code>healthy</code>이면 정상입니다</li>
              <li><code>unhealthy</code>이면 API 서버가 실행 중인지, 보안그룹이 올바른지 확인하세요</li>
              <li><code>initial</code>이면 아직 헬스체크 진행 중입니다 (1~2분 대기)</li>
            </ul>
            <div class="screenshot-placeholder">[스크린샷: 대상 그룹 Targets 탭 - healthy 상태]</div>

            <div class="info-box warning">
              <div class="info-box-title">unhealthy가 된다면?</div>
              <p>가장 흔한 원인:</p>
              <ul>
                <li>API 서버가 실행 중이 아님 (pm2 status로 확인)</li>
                <li>보안그룹에서 ALB(sg-alb)의 5000 포트 접근을 허용하지 않음</li>
                <li>헬스체크 경로가 잘못됨 (404 응답)</li>
              </ul>
            </div>
          </li>

          <!-- Step 6 -->
          <li class="step">
            <div class="step-title">ALB DNS로 API 접속 확인</div>
            <p><strong>AWS 콘솔 &rarr; EC2 &rarr; Load Balancers &rarr; alb-shopeasy</strong></p>
            <p><strong>DNS name</strong>을 복사합니다 (예: <code>alb-shopeasy-123456789.ap-northeast-2.elb.amazonaws.com</code>)</p>

            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># ALB DNS로 API 접속 테스트
curl http://alb-shopeasy-123456789.ap-northeast-2.elb.amazonaws.com/api/products</code></pre>
            </div>

            <p>상품 목록 JSON이 반환되면 성공입니다!</p>
            <div class="screenshot-placeholder">[스크린샷: ALB DNS로 API 응답 확인]</div>

            <div class="info-box tip">
              <div class="info-box-title">프론트엔드 연동 업데이트</div>
              <p>이제 프론트엔드의 API URL을 ALB DNS로 변경해야 합니다. Nginx 리버스 프록시 설정에서 <code>proxy_pass</code>를 ALB DNS로 변경하세요:</p>
            </div>

            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 프론트엔드 EC2에서 Nginx 설정 수정
sudo vi /etc/nginx/conf.d/shopeasy.conf

# proxy_pass를 ALB DNS로 변경:
# proxy_pass http://alb-shopeasy-123456789.ap-northeast-2.elb.amazonaws.com/api/;

sudo nginx -t
sudo systemctl restart nginx</code></pre>
            </div>
          </li>

          <!-- Step 7 -->
          <li class="step">
            <div class="step-title">장애 시 자동 라우팅 확인</div>
            <p>ALB의 핵심 기능을 확인합니다. API 서버 1대를 중지하고, ALB가 자동으로 나머지 서버에 트래픽을 보내는지 테스트합니다.</p>

            <p><strong>AWS 콘솔 &rarr; EC2 &rarr; Instances &rarr; ShopEasy-API-2 선택 &rarr; Instance state &rarr; Stop instance</strong></p>

            <div class="screenshot-placeholder">[스크린샷: ShopEasy-API-2 중지]</div>

            <p>1~2분 후 대상 그룹에서 상태를 확인합니다:</p>
            <p><strong>Target Groups &rarr; tg-shopeasy-api &rarr; Targets 탭</strong></p>
            <ul>
              <li>ShopEasy-API: <code>healthy</code></li>
              <li>ShopEasy-API-2: <code>unhealthy</code> 또는 <code>draining</code></li>
            </ul>

            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 서버 1대가 죽었는데도 정상 응답하는지 확인
curl http://alb-shopeasy-123456789.ap-northeast-2.elb.amazonaws.com/api/products

# 여러 번 요청해도 정상 응답 (나머지 1대가 처리)
for i in {1..5}; do
  curl -s -o /dev/null -w "요청 $i: HTTP %{http_code}\n" \
    http://alb-shopeasy-123456789.ap-northeast-2.elb.amazonaws.com/api/products
done</code></pre>
            </div>

            <div class="info-box analogy">
              <div class="info-box-title">비유로 이해하기</div>
              <p>3개의 계산대가 있는 마트에서 1번 계산대 직원이 갑자기 아프다고 합니다. 매니저(ALB)가 즉시 "1번 계산대 닫겠습니다. 2번, 3번으로 가세요"라고 안내합니다. 고객은 잠깐의 지연 없이 계속 계산할 수 있죠. 이것이 ALB가 하는 일입니다.</p>
            </div>

            <p>테스트가 끝나면 <strong>ShopEasy-API-2를 다시 Start</strong>합니다.</p>
            <div class="screenshot-placeholder">[스크린샷: 대상 그룹 - 하나 unhealthy, 하나 healthy]</div>
          </li>
        </ol>
      </div>

      <div class="info-box concept">
        <div class="info-box-title">이번 챕터에서 달성한 것</div>
        <ul>
          <li>ALB를 생성하여 API 서버 2대에 트래픽 분배</li>
          <li>헬스체크로 서버 상태를 자동 모니터링</li>
          <li>서버 장애 시 자동으로 정상 서버에만 트래픽 전달 확인</li>
          <li>보안그룹 체이닝을 ALB까지 확장</li>
          <li>프론트엔드를 ALB DNS로 연동</li>
        </ul>
      </div>
    </section>

    <div class="chapter-nav">
      <a href="10-vpc-redeploy.html" class="prev">이전: 이커머스를 VPC에 재배포</a>
      <a href="12-auto-scaling.html" class="next">다음: Auto Scaling</a>
    </div>
  </main>
</div>

<script src="../assets/js/main.js"></script>
</body>

</html>
