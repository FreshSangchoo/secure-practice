<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Gateway + Lambda - AWS 기초 강의</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>

<header class="site-header">
  <div class="header-inner">
    <a href="../index.html" class="header-logo">
      <span class="aws-icon">AWS</span>
      <span>기초 강의</span>
    </a>
  </div>
</header>

<div class="page-layout">
  <nav class="sidebar">
    <ul class="sidebar-nav">
      <li class="sidebar-section">API Gateway</li>
      <li><a href="#api-gateway-concept">API Gateway란?</a></li>
      <li><a href="#rest-api-structure">REST API 구조</a></li>
      <li><a href="#lambda-proxy">Lambda 프록시 통합</a></li>
      <li><a href="#stages">스테이지와 배포</a></li>
      <li><a href="#cors">CORS 설정</a></li>
      <li><a href="#lab">실습</a></li>
    </ul>
  </nav>

  <main class="main-content">
    <div class="chapter-header">
      <span class="chapter-num">Chapter 22</span>
      <h1>API Gateway + Lambda</h1>
      <div class="objectives">
        <h3>학습 목표</h3>
        <ul>
          <li>API Gateway의 개념과 역할을 이해한다</li>
          <li>REST API의 리소스, 메서드, 통합 구조를 설명할 수 있다</li>
          <li>Lambda 프록시 통합의 동작 방식을 이해한다</li>
          <li>API Gateway에서 REST API를 생성하고 Lambda 함수와 연결할 수 있다</li>
          <li>CORS를 설정하여 브라우저에서 API를 호출할 수 있다</li>
        </ul>
      </div>
    </div>

    <!-- Section 1: API Gateway란? -->
    <section class="content-section" id="api-gateway-concept">
      <h2>API Gateway란?</h2>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 레스토랑 입구의 호스트</div>
        <p>레스토랑에 가면 입구에서 호스트가 맞이해주죠? "몇 분이세요?", "예약하셨나요?" 확인한 후 적절한 테이블로 안내합니다. 주방에 직접 가서 주문하지 않고, 호스트와 웨이터를 통해 소통합니다.</p>
        <p><strong>API Gateway가 바로 이 호스트입니다.</strong> 클라이언트(손님)의 요청을 받아서, 적절한 백엔드 서비스(주방)로 전달하고, 응답을 돌려줍니다.</p>
      </div>

      <h3>API Gateway의 역할</h3>
      <ul>
        <li><strong>요청 라우팅</strong> - URL 경로와 HTTP 메서드에 따라 적절한 백엔드로 전달</li>
        <li><strong>인증/인가</strong> - API 키, JWT 토큰 검증</li>
        <li><strong>트래픽 관리</strong> - 요청 수 제한(Throttling), 사용량 계획</li>
        <li><strong>요청/응답 변환</strong> - 데이터 형식 변환</li>
        <li><strong>CORS 처리</strong> - 브라우저의 교차 출처 요청 허용</li>
        <li><strong>캐싱</strong> - 자주 요청되는 응답을 캐시</li>
      </ul>

      <h3>왜 API Gateway + Lambda 조합을 사용하나?</h3>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 자판기 vs 레스토랑</div>
        <p>EC2에서 항상 돌아가는 API 서버는 "레스토랑"과 같습니다. 손님이 없어도 직원이 출근해 있죠(비용 발생). 반면 API Gateway + Lambda는 "자판기"와 같습니다. 누가 버튼을 누를 때만 작동하고, 나머지 시간은 전기만 조금 씁니다(거의 무료).</p>
      </div>

      <table>
        <thead>
          <tr><th>비교</th><th>EC2 + ALB (현재)</th><th>API Gateway + Lambda</th></tr>
        </thead>
        <tbody>
          <tr><td>서버 관리</td><td>EC2 인스턴스 관리 필요</td><td>서버 관리 불필요</td></tr>
          <tr><td>비용</td><td>인스턴스 시간당 과금</td><td>요청당 과금</td></tr>
          <tr><td>확장</td><td>Auto Scaling 설정</td><td>자동 확장</td></tr>
          <tr><td>적합한 경우</td><td>항상 트래픽이 있는 주요 API</td><td>가끔 호출되는 보조 API</td></tr>
        </tbody>
      </table>

      <div class="info-box concept">
        <div class="info-box-title">ShopEasy에서의 활용</div>
        <p>ShopEasy의 핵심 API(상품 CRUD, 주문 처리)는 EC2 + ALB로 유지하고, <strong>가끔 사용되는 검색 API</strong>를 API Gateway + Lambda로 구현합니다. 이렇게 하면 검색 기능에 대한 서버 비용을 절약할 수 있습니다.</p>
      </div>
    </section>

    <!-- Section 2: REST API 구조 -->
    <section class="content-section" id="rest-api-structure">
      <h2>REST API 구조</h2>

      <h3>리소스 (Resource)</h3>
      <p>API의 URL 경로를 구성하는 단위입니다. 트리 구조로 이루어져 있습니다.</p>
      <div class="code-block">
        <div class="code-header"><span class="lang">text</span><button class="copy-btn">복사</button></div>
        <pre><code>/                    ← 루트 리소스
├── /search          ← 검색 리소스
├── /products        ← 상품 리소스
│   └── /{id}        ← 개별 상품 (경로 파라미터)
└── /health          ← 헬스체크</code></pre>
      </div>

      <h3>메서드 (Method)</h3>
      <p>각 리소스에 대해 어떤 HTTP 메서드를 허용할지 설정합니다.</p>
      <table>
        <thead>
          <tr><th>HTTP 메서드</th><th>용도</th><th>예시</th></tr>
        </thead>
        <tbody>
          <tr><td><code>GET</code></td><td>데이터 조회</td><td>GET /search?q=노트북</td></tr>
          <tr><td><code>POST</code></td><td>데이터 생성</td><td>POST /products</td></tr>
          <tr><td><code>PUT</code></td><td>데이터 수정</td><td>PUT /products/123</td></tr>
          <tr><td><code>DELETE</code></td><td>데이터 삭제</td><td>DELETE /products/123</td></tr>
          <tr><td><code>OPTIONS</code></td><td>CORS 프리플라이트</td><td>브라우저 자동 전송</td></tr>
        </tbody>
      </table>

      <h3>통합 (Integration)</h3>
      <p>메서드가 호출되었을 때 어떤 백엔드 서비스로 연결할지 설정합니다.</p>
      <ul>
        <li><strong>Lambda Function</strong> - Lambda 함수 연결 (가장 많이 사용)</li>
        <li><strong>HTTP</strong> - 외부 HTTP 엔드포인트 연결</li>
        <li><strong>AWS Service</strong> - 다른 AWS 서비스 직접 연결</li>
        <li><strong>Mock</strong> - 테스트용 가짜 응답</li>
      </ul>
    </section>

    <!-- Section 3: Lambda 프록시 통합 -->
    <section class="content-section" id="lambda-proxy">
      <h2>Lambda 프록시 통합이란?</h2>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 택배 배송 방식</div>
        <p><strong>일반 통합</strong> = 택배 기사가 상자를 열어서 내용물만 전달. 받는 사람은 박스 정보를 모름.</p>
        <p><strong>프록시 통합</strong> = 택배 기사가 상자째로 전달. 받는 사람이 직접 열어봄. 상자에 적힌 보낸 사람, 주소 등 모든 정보를 볼 수 있음.</p>
      </div>

      <p>Lambda 프록시 통합을 사용하면 API Gateway가 HTTP 요청의 <strong>모든 정보</strong>를 그대로 Lambda에 전달합니다.</p>

      <h3>Lambda가 받는 이벤트 (프록시 통합)</h3>
      <div class="code-block">
        <div class="code-header"><span class="lang">json</span><button class="copy-btn">복사</button></div>
        <pre><code>{
    "httpMethod": "GET",
    "path": "/search",
    "queryStringParameters": {
        "q": "노트북",
        "category": "electronics"
    },
    "headers": {
        "Accept": "application/json",
        "Host": "api-id.execute-api.ap-northeast-2.amazonaws.com"
    },
    "body": null,
    "isBase64Encoded": false,
    "requestContext": {
        "stage": "prod",
        "requestId": "abc123"
    }
}</code></pre>
      </div>

      <h3>Lambda가 반환해야 하는 형식</h3>
      <p>프록시 통합 시 Lambda는 반드시 다음 형식으로 응답해야 합니다:</p>
      <div class="code-block">
        <div class="code-header"><span class="lang">javascript</span><button class="copy-btn">복사</button></div>
        <pre><code>// Lambda 함수의 반환 형식 (프록시 통합)
return {
    statusCode: 200,              // HTTP 상태 코드 (필수)
    headers: {                    // 응답 헤더 (선택)
        "Content-Type": "application/json",
        "Access-Control-Allow-Origin": "*"
    },
    body: JSON.stringify({        // 응답 본문 (필수, 문자열)
        results: [...],
        total: 10
    })
};</code></pre>
      </div>

      <div class="info-box warning">
        <div class="info-box-title">주의: body는 반드시 문자열이어야 합니다</div>
        <p><code>body</code>에 객체를 직접 넣으면 <code>502 Internal Server Error</code>가 발생합니다. 반드시 <code>JSON.stringify()</code>로 문자열로 변환하세요.</p>
      </div>
    </section>

    <!-- Section 4: 스테이지와 배포 -->
    <section class="content-section" id="stages">
      <h2>스테이지와 배포</h2>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 연극 리허설과 본 공연</div>
        <p>연극을 할 때 리허설(dev)과 본 공연(prod)이 있죠? 같은 연극이지만, 리허설은 실수해도 되고, 본 공연은 실수하면 안 됩니다. API Gateway의 스테이지도 같습니다.</p>
      </div>

      <h3>스테이지 (Stage)</h3>
      <p>API의 배포 버전을 나타내는 논리적 환경입니다.</p>
      <ul>
        <li><code>dev</code> - 개발 환경 (https://api-id.../dev/search)</li>
        <li><code>staging</code> - 스테이징 환경</li>
        <li><code>prod</code> - 운영 환경 (https://api-id.../prod/search)</li>
      </ul>

      <h3>배포 (Deployment)</h3>
      <p>API 설정을 변경한 후에는 반드시 <strong>배포</strong>를 해야 변경사항이 적용됩니다. 배포하지 않으면 이전 버전이 계속 서비스됩니다.</p>

      <h3>API Gateway URL 형식</h3>
      <div class="code-block">
        <div class="code-header"><span class="lang">text</span><button class="copy-btn">복사</button></div>
        <pre><code>https://{api-id}.execute-api.{region}.amazonaws.com/{stage}/{resource}

예시:
https://abc123def.execute-api.ap-northeast-2.amazonaws.com/prod/search?q=노트북</code></pre>
      </div>
    </section>

    <!-- Section 5: CORS -->
    <section class="content-section" id="cors">
      <h2>CORS 설정</h2>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 아파트 방문자 출입</div>
        <p>아파트에 외부 방문자가 오면 경비실에서 "어디서 오셨나요?"라고 확인합니다. 거주자가 "허용"이라고 하면 들어올 수 있죠. CORS도 같습니다. 브라우저(경비실)가 "이 웹사이트에서 다른 도메인의 API를 호출해도 되나요?"라고 확인하고, 서버가 "허용"이라고 응답해야 합니다.</p>
      </div>

      <h3>CORS가 필요한 이유</h3>
      <p>브라우저는 보안을 위해 <strong>같은 도메인</strong>이 아닌 곳에서 API를 호출하면 차단합니다. CloudFront 도메인에서 API Gateway 도메인의 API를 호출하면 도메인이 다르므로 CORS 설정이 필요합니다.</p>

      <div class="info-box tip">
        <div class="info-box-title">참고: CloudFront 다중 오리진 사용 시</div>
        <p>Chapter 19에서 CloudFront에 API Gateway를 오리진으로 추가하면 같은 도메인이 되어 CORS가 필요 없습니다. 하지만 독립적으로 API Gateway URL을 사용할 경우 CORS 설정이 필요합니다.</p>
      </div>

      <h3>CORS 응답 헤더</h3>
      <div class="code-block">
        <div class="code-header"><span class="lang">text</span><button class="copy-btn">복사</button></div>
        <pre><code>Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type, Authorization</code></pre>
      </div>
    </section>

    <!-- Lab Section -->
    <section class="content-section" id="lab">
      <h2>실습</h2>

      <div class="info-box danger">
        <div class="info-box-title">비용 안내</div>
        <p>API Gateway는 프리티어에서 12개월간 매월 100만 건의 REST API 호출이 무료입니다. Lambda 프리티어와 함께 이 실습은 무료 범위 내에서 수행할 수 있습니다.</p>
      </div>

      <div class="lab-section">
        <div class="lab-title">실습: 상품 검색 API 만들기 (API Gateway + Lambda)</div>
        <ol class="steps">

          <!-- Step 1 -->
          <li class="step">
            <div class="step-title">Lambda 검색 함수 생성</div>
            <p>먼저 DynamoDB에서 상품을 검색하는 Lambda 함수를 만듭니다.</p>
            <p><strong>Lambda</strong> > <strong>Create function</strong></p>
            <ul>
              <li><strong>Function name</strong>: <code>shopeasy-product-search</code></li>
              <li><strong>Runtime</strong>: <code>Node.js 20.x</code></li>
              <li><strong>Architecture</strong>: <code>arm64</code></li>
            </ul>
            <p><strong>Create function</strong>을 클릭합니다.</p>
          </li>

          <!-- Step 2 -->
          <li class="step">
            <div class="step-title">IAM 역할에 DynamoDB 권한 추가</div>
            <p><strong>Configuration</strong> > <strong>Permissions</strong> > 역할 이름 클릭</p>
            <p><strong>Add permissions</strong> > <strong>Attach policies</strong></p>
            <p><code>AmazonDynamoDBReadOnlyAccess</code>를 검색하여 추가합니다.</p>
            <div class="screenshot-placeholder">IAM 역할에 DynamoDB 읽기 권한 추가</div>
          </li>

          <!-- Step 3 -->
          <li class="step">
            <div class="step-title">검색 Lambda 함수 코드 작성</div>
            <p><code>index.mjs</code>를 다음 코드로 교체합니다:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">javascript</span><button class="copy-btn">복사</button></div>
              <pre><code>import { DynamoDBClient } from '@aws-sdk/client-dynamodb';
import { DynamoDBDocumentClient, ScanCommand } from '@aws-sdk/lib-dynamodb';

const client = new DynamoDBClient({});
const docClient = DynamoDBDocumentClient.from(client);

const TABLE_NAME = process.env.TABLE_NAME || 'shopeasy-products';

export const handler = async (event) => {
    console.log("검색 요청:", JSON.stringify(event, null, 2));

    // CORS 헤더
    const headers = {
        "Content-Type": "application/json",
        "Access-Control-Allow-Origin": "*",
        "Access-Control-Allow-Methods": "GET, OPTIONS",
        "Access-Control-Allow-Headers": "Content-Type"
    };

    // OPTIONS 요청 처리 (CORS 프리플라이트)
    if (event.httpMethod === 'OPTIONS') {
        return { statusCode: 200, headers, body: '' };
    }

    try {
        // 쿼리 파라미터에서 검색어 추출
        const query = event.queryStringParameters?.q || '';
        const category = event.queryStringParameters?.category || '';
        const limit = parseInt(event.queryStringParameters?.limit) || 20;

        console.log(`검색어: "${query}", 카테고리: "${category}", 제한: ${limit}`);

        if (!query && !category) {
            return {
                statusCode: 400,
                headers,
                body: JSON.stringify({
                    error: '검색어(q) 또는 카테고리(category) 파라미터가 필요합니다.',
                    usage: 'GET /search?q=노트북 또는 GET /search?category=electronics'
                })
            };
        }

        // DynamoDB Scan (실무에서는 OpenSearch 등을 사용하는 것이 좋음)
        const params = {
            TableName: TABLE_NAME,
            Limit: limit
        };

        // 필터 표현식 구성
        const filterExpressions = [];
        const expressionValues = {};
        const expressionNames = {};

        if (query) {
            filterExpressions.push('contains(#name, :query)');
            expressionValues[':query'] = query;
            expressionNames['#name'] = 'name';
        }

        if (category) {
            filterExpressions.push('#cat = :category');
            expressionValues[':category'] = category;
            expressionNames['#cat'] = 'category';
        }

        if (filterExpressions.length > 0) {
            params.FilterExpression = filterExpressions.join(' AND ');
            params.ExpressionAttributeValues = expressionValues;
            params.ExpressionAttributeNames = expressionNames;
        }

        const command = new ScanCommand(params);
        const result = await docClient.send(command);

        console.log(`검색 결과: ${result.Items.length}건`);

        return {
            statusCode: 200,
            headers,
            body: JSON.stringify({
                query: query,
                category: category,
                results: result.Items,
                count: result.Items.length,
                scannedCount: result.ScannedCount
            })
        };

    } catch (error) {
        console.error("검색 에러:", error);
        return {
            statusCode: 500,
            headers,
            body: JSON.stringify({
                error: '검색 처리 중 오류가 발생했습니다.',
                message: error.message
            })
        };
    }
};</code></pre>
            </div>
            <p><strong>Deploy</strong>를 클릭합니다.</p>
          </li>

          <!-- Step 4 -->
          <li class="step">
            <div class="step-title">환경변수 설정</div>
            <p><strong>Configuration</strong> > <strong>Environment variables</strong> > <strong>Edit</strong></p>
            <table>
              <thead><tr><th>Key</th><th>Value</th></tr></thead>
              <tbody>
                <tr><td><code>TABLE_NAME</code></td><td><code>shopeasy-products</code> (실제 DynamoDB 테이블 이름)</td></tr>
              </tbody>
            </table>
            <p><strong>Save</strong>를 클릭합니다.</p>
          </li>

          <!-- Step 5 -->
          <li class="step">
            <div class="step-title">REST API 생성</div>
            <p>AWS 콘솔에서 <strong>API Gateway</strong> 서비스로 이동합니다.</p>
            <p><strong>REST API</strong> (REST API - private이 아닌 것)에서 <strong>Build</strong>를 클릭합니다.</p>
            <ul>
              <li><strong>Protocol</strong>: <code>REST</code></li>
              <li><strong>Create new API</strong>: <code>New API</code></li>
              <li><strong>API name</strong>: <code>shopeasy-search-api</code></li>
              <li><strong>Description</strong>: <code>ShopEasy 상품 검색 API</code></li>
              <li><strong>Endpoint Type</strong>: <code>Regional</code></li>
            </ul>
            <p><strong>Create API</strong>를 클릭합니다.</p>
            <div class="screenshot-placeholder">API Gateway REST API 생성 화면</div>
          </li>

          <!-- Step 6 -->
          <li class="step">
            <div class="step-title">/search 리소스 생성</div>
            <p>왼쪽 메뉴에서 <strong>Resources</strong>를 선택합니다.</p>
            <p>루트 리소스(<code>/</code>)를 선택하고 <strong>Create Resource</strong>를 클릭합니다.</p>
            <ul>
              <li><strong>Resource Name</strong>: <code>search</code></li>
              <li><strong>Resource Path</strong>: <code>/search</code> (자동 입력됨)</li>
              <li><strong>Enable API Gateway CORS</strong>: 체크!</li>
            </ul>
            <p><strong>Create Resource</strong>를 클릭합니다.</p>
            <div class="screenshot-placeholder">/search 리소스 생성 화면</div>
          </li>

          <!-- Step 7 -->
          <li class="step">
            <div class="step-title">GET 메서드 생성 및 Lambda 연결</div>
            <p><code>/search</code> 리소스를 선택하고 <strong>Create Method</strong>를 클릭합니다.</p>
            <ul>
              <li><strong>Method type</strong>: <code>GET</code></li>
              <li><strong>Integration type</strong>: <code>Lambda Function</code></li>
              <li><strong>Lambda Proxy integration</strong>: 체크! (중요)</li>
              <li><strong>Lambda Function</strong>: <code>shopeasy-product-search</code> 검색하여 선택</li>
            </ul>
            <p><strong>Create Method</strong>를 클릭합니다.</p>
            <p>"Add Permission to Lambda Function" 대화상자가 나타나면 <strong>OK</strong>를 클릭합니다. (API Gateway가 Lambda를 호출할 수 있는 권한 부여)</p>
            <div class="screenshot-placeholder">GET 메서드 - Lambda 프록시 통합 설정</div>
          </li>

          <!-- Step 8 -->
          <li class="step">
            <div class="step-title">CORS 활성화</div>
            <p>리소스 생성 시 CORS를 체크했다면 OPTIONS 메서드가 자동 생성되었을 것입니다. 확인합니다.</p>
            <p>만약 자동 생성되지 않았다면, <code>/search</code> 리소스를 선택하고 <strong>Enable CORS</strong>를 클릭합니다:</p>
            <ul>
              <li><strong>Access-Control-Allow-Origin</strong>: <code>*</code></li>
              <li><strong>Access-Control-Allow-Methods</strong>: <code>GET, OPTIONS</code></li>
              <li><strong>Access-Control-Allow-Headers</strong>: <code>Content-Type,Authorization</code></li>
            </ul>
            <p><strong>Save</strong>를 클릭합니다.</p>
            <div class="screenshot-placeholder">CORS 설정 화면</div>
          </li>

          <!-- Step 9 -->
          <li class="step">
            <div class="step-title">API 배포 (prod 스테이지)</div>
            <p><strong>Deploy API</strong> 버튼을 클릭합니다.</p>
            <ul>
              <li><strong>Stage</strong>: <code>*New Stage*</code> 선택</li>
              <li><strong>Stage name</strong>: <code>prod</code></li>
              <li><strong>Stage description</strong>: <code>운영 환경</code></li>
            </ul>
            <p><strong>Deploy</strong>를 클릭합니다.</p>
            <div class="screenshot-placeholder">API 배포 - prod 스테이지 생성</div>

            <p>배포가 완료되면 <strong>Invoke URL</strong>이 표시됩니다. 이것이 API의 엔드포인트입니다:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">text</span><button class="copy-btn">복사</button></div>
              <pre><code>https://abc123def.execute-api.ap-northeast-2.amazonaws.com/prod</code></pre>
            </div>

            <div class="info-box warning">
              <div class="info-box-title">중요: 설정 변경 후 재배포 필수!</div>
              <p>API 설정(리소스, 메서드, CORS 등)을 변경한 후에는 반드시 <strong>Deploy API</strong>를 다시 해야 변경사항이 반영됩니다. 배포하지 않으면 이전 설정이 계속 적용됩니다.</p>
            </div>
          </li>

          <!-- Step 10 -->
          <li class="step">
            <div class="step-title">API Gateway URL로 검색 API 테스트</div>
            <p>브라우저 또는 터미널에서 API를 테스트합니다.</p>

            <h4>브라우저에서 테스트</h4>
            <p>브라우저 주소창에 다음 URL을 입력합니다:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">url</span><button class="copy-btn">복사</button></div>
              <pre><code>https://abc123def.execute-api.ap-northeast-2.amazonaws.com/prod/search?q=노트북</code></pre>
            </div>

            <h4>CLI에서 테스트</h4>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 검색어로 검색
curl "https://abc123def.execute-api.ap-northeast-2.amazonaws.com/prod/search?q=노트북"

# 카테고리로 검색
curl "https://abc123def.execute-api.ap-northeast-2.amazonaws.com/prod/search?category=electronics"

# 검색어 + 카테고리 조합
curl "https://abc123def.execute-api.ap-northeast-2.amazonaws.com/prod/search?q=노트북&category=electronics&limit=5"

# 파라미터 없이 호출 (에러 응답 확인)
curl "https://abc123def.execute-api.ap-northeast-2.amazonaws.com/prod/search"</code></pre>
            </div>
            <div class="screenshot-placeholder">API 테스트 응답 결과</div>
          </li>

          <!-- Step 11 -->
          <li class="step">
            <div class="step-title">API Gateway 콘솔에서 테스트</div>
            <p>API Gateway 콘솔에서도 직접 테스트할 수 있습니다.</p>
            <p><strong>Resources</strong> > <code>/search</code> > <code>GET</code> 메서드 선택 > <strong>Test</strong> 탭 클릭</p>
            <ul>
              <li><strong>Query Strings</strong>에 <code>q=노트북</code> 입력</li>
              <li><strong>Test</strong> 버튼 클릭</li>
            </ul>
            <p>응답 상태 코드, 헤더, 본문을 확인합니다.</p>
            <div class="screenshot-placeholder">API Gateway 콘솔 내 테스트 화면</div>
          </li>

          <!-- Step 12 -->
          <li class="step">
            <div class="step-title">CloudWatch에서 API 호출 로그 확인</div>
            <p>Lambda 함수의 <strong>Monitor</strong> 탭에서 호출 수, 에러율, 실행 시간을 확인합니다.</p>
            <p><strong>View CloudWatch logs</strong>에서 상세 로그를 확인합니다:</p>
            <ul>
              <li>검색 쿼리 파라미터</li>
              <li>DynamoDB 검색 결과 건수</li>
              <li>실행 시간</li>
            </ul>
            <div class="screenshot-placeholder">CloudWatch - 검색 API Lambda 실행 로그</div>
          </li>

        </ol>
      </div>

      <div class="info-box concept">
        <div class="info-box-title">현재 아키텍처 업데이트</div>
        <p>이제 검색 API가 추가되어 아키텍처가 확장되었습니다:</p>
      </div>

      <div class="diagram">
        <div class="diagram-title">현재 아키텍처 (검색 API 추가)</div>
        <div class="diagram-row">
          <div class="diagram-box user"><div class="box-title">사용자</div></div>
        </div>
        <div class="diagram-arrow down">&darr;</div>
        <div class="diagram-row">
          <div class="diagram-box cdn"><div class="box-title">CloudFront</div></div>
        </div>
        <div class="diagram-row" style="margin-top:0.5rem;">
          <div class="diagram-col" style="flex:1; align-items:center;">
            <div style="font-weight:600; margin-bottom:0.5rem;">/*</div>
            <div class="diagram-arrow down">&darr;</div>
            <div class="diagram-box storage"><div class="box-title">S3</div><div class="box-sub">프론트엔드</div></div>
          </div>
          <div class="diagram-col" style="flex:1; align-items:center;">
            <div style="font-weight:600; margin-bottom:0.5rem;">/api/*</div>
            <div class="diagram-arrow down">&darr;</div>
            <div class="diagram-box network"><div class="box-title">ALB</div></div>
            <div class="diagram-arrow down">&darr;</div>
            <div class="diagram-box compute"><div class="box-title">EC2</div><div class="box-sub">API 서버</div></div>
            <div class="diagram-arrow down">&darr;</div>
            <div class="diagram-row">
              <div class="diagram-box database"><div class="box-title">RDS</div></div>
              <div class="diagram-box database"><div class="box-title">DynamoDB</div></div>
              <div class="diagram-box storage"><div class="box-title">S3</div></div>
            </div>
          </div>
          <div class="diagram-col" style="flex:1; align-items:center;">
            <div style="font-weight:600; margin-bottom:0.5rem;">/search/*</div>
            <div class="diagram-arrow down">&darr;</div>
            <div class="diagram-box serverless"><div class="box-title">API Gateway</div></div>
            <div class="diagram-arrow down">&darr;</div>
            <div class="diagram-box serverless"><div class="box-title">Lambda</div></div>
            <div class="diagram-arrow down">&darr;</div>
            <div class="diagram-box database"><div class="box-title">DynamoDB</div><div class="box-sub">상품 검색</div></div>
          </div>
        </div>
        <div style="margin-top:1.5rem; padding-top:1rem; border-top:2px dashed #ddd;">
          <div style="font-weight:600; margin-bottom:0.5rem; color:#e67e22;">[새로 추가]</div>
          <div class="diagram-row">
            <div class="diagram-box storage"><div class="box-title">S3 업로드</div></div>
            <div class="diagram-arrow">&rarr; 트리거</div>
            <div class="diagram-box serverless"><div class="box-title">Lambda</div><div class="box-sub">이미지 리사이징</div></div>
            <div class="diagram-arrow">&rarr;</div>
            <div class="diagram-box storage"><div class="box-title">S3</div><div class="box-sub">썸네일</div></div>
          </div>
        </div>
      </div>
    </section>

    <div class="chapter-nav">
      <a href="21-lambda-image-resize.html" class="prev">이전: S3 + Lambda 이미지 처리</a>
      <a href="23-sqs-sns.html" class="next">다음: SQS & SNS</a>
    </div>
  </main>
</div>

<script src="../assets/js/main.js"></script>
</body>

</html>
