<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EC2에 프론트엔드 배포 - AWS 기초 강의</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>

<header class="site-header">
  <div class="header-inner">
    <a href="../index.html" class="header-logo">
      <span class="aws-icon">AWS</span>
      <span>기초 강의</span>
    </a>
  </div>
</header>

<div class="page-layout">
  <nav class="sidebar">
    <ul class="sidebar-nav">
      <li><a href="#what-is-nginx">Nginx란?</a></li>
      <li><a href="#reverse-proxy">리버스 프록시</a></li>
      <li><a href="#react-build">React 빌드란?</a></li>
      <li><a href="#lab">실습</a></li>
    </ul>
  </nav>

  <main class="main-content">
    <div class="chapter-header">
      <span class="chapter-num">Chapter 06</span>
      <h1>EC2에 프론트엔드 배포</h1>
      <div class="objectives">
        <h3>학습 목표</h3>
        <ul>
          <li>Nginx의 역할과 용도를 설명할 수 있다</li>
          <li>리버스 프록시의 개념을 이해할 수 있다</li>
          <li>React 앱을 빌드하고 Nginx로 서빙할 수 있다</li>
          <li>Nginx의 리버스 프록시를 설정하여 API 서버와 연결할 수 있다</li>
        </ul>
      </div>
    </div>

    <!-- Nginx란? -->
    <section class="content-section" id="what-is-nginx">
      <h2>Nginx란?</h2>

      <p>
        <strong>Nginx(엔진엑스)</strong>는 전 세계에서 가장 많이 사용되는 <strong>웹 서버</strong>입니다.
        웹 서버란, 사용자의 브라우저가 "이 웹 페이지를 보여줘"라고 요청하면
        HTML, CSS, JavaScript, 이미지 등의 파일을 전달해주는 프로그램입니다.
      </p>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 레스토랑의 안내 직원(호스트)</div>
        <p>
          레스토랑에 들어가면 안내 직원이 있죠? 이 사람이 하는 일은:<br><br>
          <strong>1. 손님 안내:</strong> "어서오세요, 이쪽 자리로 안내해드리겠습니다" → 사용자 요청을 적절한 곳으로 전달<br>
          <strong>2. 메뉴판 제공:</strong> 미리 인쇄된 메뉴판을 건네줌 → HTML/CSS/JS 파일을 전달<br>
          <strong>3. 주방 연결:</strong> "이 주문은 주방으로 전달하겠습니다" → API 요청을 백엔드 서버로 전달<br>
          <strong>4. 동시 대응:</strong> 여러 손님을 동시에 안내 → 수많은 요청을 동시에 처리<br><br>
          Nginx가 바로 이 안내 직원 역할을 합니다!
        </p>
      </div>

      <h3>Nginx의 주요 역할</h3>
      <table>
        <thead>
          <tr>
            <th>역할</th>
            <th>설명</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>정적 파일 서빙</strong></td>
            <td>HTML, CSS, JS, 이미지 파일을 사용자에게 전달</td>
          </tr>
          <tr>
            <td><strong>리버스 프록시</strong></td>
            <td>특정 요청을 백엔드 서버(API)로 전달</td>
          </tr>
          <tr>
            <td><strong>로드 밸런싱</strong></td>
            <td>여러 서버에 요청을 분산</td>
          </tr>
          <tr>
            <td><strong>SSL/HTTPS 처리</strong></td>
            <td>암호화된 통신을 처리</td>
          </tr>
        </tbody>
      </table>

      <div class="info-box concept">
        <div class="info-box-title">왜 Node.js로 프론트엔드를 서빙하지 않나요?</div>
        <p>
          기술적으로는 Node.js로 정적 파일도 서빙할 수 있습니다.
          하지만 Nginx가 정적 파일 처리에 훨씬 빠르고 효율적입니다.
          Node.js는 API 로직에 집중하고, 정적 파일 서빙은 Nginx가 담당하는 것이 실무에서의 표준입니다.
        </p>
      </div>
    </section>

    <!-- 리버스 프록시 -->
    <section class="content-section" id="reverse-proxy">
      <h2>리버스 프록시 개념</h2>

      <p>
        <strong>리버스 프록시</strong>란, 사용자의 요청을 받아서 뒤에 있는 실제 서버로 전달해주는 중간 다리 역할입니다.
        사용자는 Nginx와만 통신하고, Nginx가 뒤에서 API 서버와 통신합니다.
      </p>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 회사의 대표전화번호</div>
        <p>
          큰 회사에 전화하면 대표번호(02-xxx-xxxx)로 연결되죠?
          교환원이 받아서 "영업부로 연결해 드리겠습니다", "기술팀으로 연결해 드리겠습니다"
          이렇게 적절한 부서로 연결해줍니다.<br><br>
          리버스 프록시도 마찬가지입니다:<br>
          - 사용자가 <code>http://쇼핑몰.com/</code>을 요청하면 → Nginx가 프론트엔드 파일을 전달<br>
          - 사용자가 <code>http://쇼핑몰.com/api/products</code>를 요청하면 → Nginx가 API 서버(포트 5000)로 전달<br><br>
          사용자는 하나의 주소(80번 포트)로만 접속하지만, 뒤에서는 프론트엔드와 API가 분리되어 있습니다.
        </p>
      </div>

      <div class="diagram">
        <div class="diagram-title">리버스 프록시 동작 원리</div>

        <div class="diagram-box user">
          <div class="box-title">사용자 브라우저</div>
          <div class="box-sub">http://EC2-IP/ (포트 80)</div>
          <div class="box-sub">http://EC2-IP/api/products</div>
        </div>

        <div class="diagram-arrow down">&darr;</div>

        <div class="diagram-group cloud">
          <div class="diagram-group-label">Nginx (포트 80)</div>
          <div class="diagram-row">
            <div class="diagram-box storage">
              <div class="box-title">/</div>
              <div class="box-sub">정적 파일 반환 (React 빌드)</div>
            </div>
            <div class="diagram-box network">
              <div class="box-title">/api/*</div>
              <div class="box-sub">프록시 전달 (포트 5000)</div>
            </div>
          </div>
        </div>

        <div class="diagram-arrow down">&darr;</div>

        <div class="diagram-box compute">
          <div class="box-title">Node.js API 서버</div>
          <div class="box-sub">포트 5000</div>
        </div>
      </div>

      <h3>리버스 프록시의 장점</h3>
      <ul>
        <li><strong>포트 통합:</strong> 사용자는 80번 포트 하나로만 접속하면 됩니다 (5000번 포트를 외울 필요 없음)</li>
        <li><strong>보안:</strong> API 서버를 직접 외부에 노출하지 않을 수 있습니다</li>
        <li><strong>유연성:</strong> 뒤에 있는 서버를 교체해도 사용자는 모릅니다</li>
        <li><strong>CORS 해결:</strong> 같은 도메인에서 요청하므로 CORS 문제가 없습니다</li>
      </ul>

      <div class="info-box analogy">
        <div class="info-box-title">비유: CORS 문제란?</div>
        <p>
          CORS를 쉽게 설명하면, 브라우저의 보안 정책입니다.
          "A 사이트(localhost:5173)에서 B 사이트(localhost:5000)로 데이터를 요청하면 차단합니다."<br><br>
          마치 아파트 경비실에서 "우리 단지 주민이 아닌 분은 출입할 수 없습니다"라고 하는 것처럼요.
          리버스 프록시를 사용하면 모든 요청이 같은 주소(80번 포트)에서 나가므로 이 문제가 사라집니다.
        </p>
      </div>
    </section>

    <!-- React 빌드 -->
    <section class="content-section" id="react-build">
      <h2>React 빌드란?</h2>

      <p>
        React 개발 서버(<code>npm run dev</code>)는 개발할 때만 사용합니다.
        실제 서비스를 배포할 때는 React 코드를 <strong>빌드(Build)</strong>하여
        순수한 HTML, CSS, JavaScript 파일로 변환합니다.
      </p>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 원고와 출판된 책</div>
        <p>
          작가가 글을 쓸 때는 편집 소프트웨어(워드)를 사용합니다. (= React 개발 서버)<br>
          하지만 독자에게 전달할 때는 인쇄된 책(PDF)으로 만듭니다. (= 빌드된 파일)<br><br>
          <code>npm run dev</code> = 워드에서 글 쓰는 중 (개발 중)<br>
          <code>npm run build</code> = 인쇄소에서 책 출판 (배포용 파일 생성)<br><br>
          빌드하면 <code>dist/</code> 폴더에 최적화된 HTML/CSS/JS 파일이 생성됩니다.
          이 파일들을 Nginx가 사용자에게 전달합니다.
        </p>
      </div>

      <div class="code-block">
        <div class="code-header">
          <span class="lang">text</span>
          <button class="copy-btn">복사</button>
        </div>
        <pre><code>빌드 전 (개발 중)              빌드 후 (배포용)
├── src/                      ├── dist/
│   ├── App.jsx               │   ├── index.html
│   ├── components/           │   └── assets/
│   ├── pages/                │       ├── index-abc123.js
│   └── ...                   │       └── index-def456.css
├── package.json              │
└── vite.config.js            └── (이 파일들만 서버에 올리면 됨)</code></pre>
      </div>
    </section>

    <!-- 실습 -->
    <section class="content-section" id="lab">
      <h2>실습</h2>

      <div class="lab-section">
        <div class="lab-title">실습: EC2에 프론트엔드 배포하기 (Nginx + React 빌드)</div>

        <div class="info-box warning">
          <div class="info-box-title">사전 조건</div>
          <p>
            Chapter 05의 실습이 완료된 상태여야 합니다:<br>
            - EC2 인스턴스가 실행 중<br>
            - SSH 접속이 가능<br>
            - API 서버가 동작 중
          </p>
        </div>

        <ol class="steps">
          <li class="step">
            <div class="step-title">EC2에 SSH 접속</div>
            <p>이전 챕터에서 만든 EC2에 접속합니다:</p>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code>ssh -i ~/Downloads/shopeasy-key.pem ec2-user@[EC2-퍼블릭-IP]</code></pre>
            </div>
          </li>

          <li class="step">
            <div class="step-title">Nginx 설치</div>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code># Nginx 설치
sudo dnf install -y nginx

# Nginx 시작
sudo systemctl start nginx

# 부팅 시 자동 시작 설정
sudo systemctl enable nginx

# 상태 확인
sudo systemctl status nginx</code></pre>
            </div>
            <p><code>active (running)</code>이 표시되면 Nginx가 정상적으로 실행된 것입니다.</p>
          </li>

          <li class="step">
            <div class="step-title">Nginx 기본 동작 확인</div>
            <p>웹 브라우저에서 EC2의 퍼블릭 IP로 접속합니다:</p>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">text</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code>http://[EC2-퍼블릭-IP]</code></pre>
            </div>
            <p>Nginx의 기본 환영 페이지가 나오면 성공입니다!</p>
            <div class="screenshot-placeholder">[스크린샷: Nginx 기본 환영 페이지]</div>

            <div class="info-box tip">
              <div class="info-box-title">페이지가 안 보이나요?</div>
              <p>
                보안그룹에 HTTP(80) 포트가 열려 있는지 확인하세요.
                Chapter 05에서 이미 설정했다면 문제 없습니다.
                EC2 콘솔 → 인스턴스 선택 → 보안 탭 → 보안그룹 → 인바운드 규칙에서 확인하세요.
              </p>
            </div>
          </li>

          <li class="step">
            <div class="step-title">프론트엔드 코드 준비 및 빌드</div>
            <p>프론트엔드 코드가 EC2에 없다면 먼저 업로드합니다:</p>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code># ecommerce-app 디렉토리에 이미 클론했다면
cd ~/ecommerce-app/frontend

# 의존성 설치
npm install</code></pre>
            </div>
            <p>React 앱을 빌드합니다:</p>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code># 빌드 실행
npm run build</code></pre>
            </div>
            <p>빌드가 완료되면 <code>dist/</code> 폴더가 생성됩니다:</p>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code># 빌드 결과 확인
ls dist/</code></pre>
            </div>
            <p><code>index.html</code>과 <code>assets/</code> 폴더가 보이면 빌드 성공입니다.</p>
          </li>

          <li class="step">
            <div class="step-title">빌드 파일을 Nginx 웹루트에 복사</div>
            <p>Nginx의 기본 웹루트 디렉토리에 빌드 파일을 복사합니다:</p>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code># 기존 기본 페이지 삭제
sudo rm -rf /usr/share/nginx/html/*

# 빌드 파일 복사
sudo cp -r ~/ecommerce-app/frontend/dist/* /usr/share/nginx/html/

# 파일 확인
ls /usr/share/nginx/html/</code></pre>
            </div>

            <div class="info-box concept">
              <div class="info-box-title">웹루트(Web Root)란?</div>
              <p>
                웹루트는 웹 서버가 파일을 찾는 기본 디렉토리입니다.
                사용자가 <code>http://사이트/</code>에 접속하면 웹루트 안의 <code>index.html</code>을 보여줍니다.
                Nginx의 기본 웹루트는 <code>/usr/share/nginx/html/</code>입니다.
              </p>
            </div>
          </li>

          <li class="step">
            <div class="step-title">Nginx 설정: 리버스 프록시</div>
            <p>Nginx 설정 파일을 수정하여 <code>/api</code> 요청을 API 서버로 전달하도록 합니다:</p>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code># Nginx 설정 파일 백업
sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup

# 새로운 설정 파일 작성
sudo tee /etc/nginx/conf.d/shopeasy.conf > /dev/null &lt;&lt;'EOF'
server {
    listen 80;
    server_name _;

    # 프론트엔드 정적 파일 서빙
    root /usr/share/nginx/html;
    index index.html;

    # React Router를 위한 설정 (새로고침 시 404 방지)
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API 요청을 Node.js 서버로 프록시
    location /api/ {
        proxy_pass http://127.0.0.1:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache_bypass $http_upgrade;
    }

    # 업로드된 파일 프록시 (리뷰 사진 등)
    location /uploads/ {
        proxy_pass http://127.0.0.1:5000;
    }
}
EOF</code></pre>
            </div>

            <div class="info-box tip">
              <div class="info-box-title">설정 파일 해설</div>
              <p>
                <code>listen 80;</code> → 80번 포트에서 요청을 받습니다<br>
                <code>root /usr/share/nginx/html;</code> → 정적 파일이 있는 경로<br>
                <code>try_files $uri $uri/ /index.html;</code> → React Router(SPA)를 위한 설정. 파일이 없으면 index.html 반환<br>
                <code>location /api/ { proxy_pass ... }</code> → /api로 시작하는 요청은 Node.js(5000포트)로 전달
              </p>
            </div>
          </li>

          <li class="step">
            <div class="step-title">기본 서버 블록 비활성화</div>
            <p>기본 server 블록과 충돌하지 않도록 기본 설정을 수정합니다:</p>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code># 기본 nginx.conf에서 server 블록 주석 처리
# 또는 default.conf 삭제
sudo rm -f /etc/nginx/conf.d/default.conf 2>/dev/null

# 설정 문법 테스트
sudo nginx -t</code></pre>
            </div>
            <p><code>syntax is ok</code>와 <code>test is successful</code> 메시지가 나와야 합니다.</p>
            <p>만약 오류가 나면 설정 파일을 다시 확인하세요.</p>
          </li>

          <li class="step">
            <div class="step-title">Nginx 재시작</div>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code># Nginx 재시작
sudo systemctl restart nginx

# 상태 확인
sudo systemctl status nginx</code></pre>
            </div>
          </li>

          <li class="step">
            <div class="step-title">API 서버가 실행 중인지 확인</div>
            <p>API 서버가 꺼져 있다면 다시 실행합니다:</p>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">bash</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code># API 서버 프로세스 확인
ps aux | grep node

# 실행 중이 아니라면 다시 시작
cd ~/ecommerce-app/api-server
nohup npm start > server.log 2>&amp;1 &amp;

# 로그로 정상 시작 확인
tail -5 server.log</code></pre>
            </div>
          </li>

          <li class="step">
            <div class="step-title">브라우저에서 쇼핑몰 확인!</div>
            <p>웹 브라우저에서 EC2의 퍼블릭 IP로 접속합니다:</p>
            <div class="code-block">
              <div class="code-header">
                <span class="lang">text</span>
                <button class="copy-btn">복사</button>
              </div>
              <pre><code>http://[EC2-퍼블릭-IP]</code></pre>
            </div>
            <p><strong>ShopEasy 쇼핑몰이 표시되면 성공!</strong></p>
            <div class="screenshot-placeholder">[스크린샷: EC2에서 실행되는 ShopEasy 쇼핑몰 메인 화면]</div>

            <p>다음을 확인해보세요:</p>
            <ul>
              <li>메인 페이지에 상품 목록이 표시되나요?</li>
              <li>상품을 클릭하면 상세 페이지가 나오나요?</li>
              <li>장바구니에 상품을 담을 수 있나요?</li>
              <li>리뷰를 작성할 수 있나요?</li>
            </ul>
          </li>
        </ol>

        <div class="info-box concept">
          <div class="info-box-title">현재 배포 상태 정리</div>
          <p>
            축하합니다! 이제 인터넷에서 접근 가능한 쇼핑몰이 완성되었습니다!<br><br>
          </p>
        </div>

        <div class="diagram">
          <div class="diagram-title">현재 아키텍처</div>

          <div class="diagram-box user">
            <div class="box-title">인터넷 사용자</div>
          </div>

          <div class="diagram-arrow down">&darr; http://[EC2-IP]</div>

          <div class="diagram-group cloud">
            <div class="diagram-group-label">EC2 인스턴스</div>

            <div class="diagram-group subnet-pub">
              <div class="diagram-group-label">Nginx (포트 80)</div>
              <div class="diagram-row">
                <div class="diagram-box storage">
                  <div class="box-title">/</div>
                  <div class="box-sub">React 빌드 파일</div>
                </div>
                <div class="diagram-box network">
                  <div class="box-title">/api/*</div>
                  <div class="box-sub">Node.js (포트 5000)</div>
                </div>
              </div>
            </div>

            <div class="diagram-arrow down">&darr;</div>

            <div class="diagram-group subnet-priv">
              <div class="diagram-group-label">Node.js API 서버 (포트 5000)</div>
              <div class="diagram-box database">
                <div class="box-title">Express.js + SQLite DB</div>
              </div>
            </div>
          </div>
        </div>

        <div class="info-box warning">
          <div class="info-box-title">현재 아키텍처의 문제점</div>
          <p>
            지금 상태로도 서비스가 작동하지만, 실제 운영에는 몇 가지 문제가 있습니다:<br><br>
            <strong>1. IP가 바뀝니다:</strong> EC2를 중지했다가 다시 시작하면 IP가 변경됩니다 (→ Chapter 07에서 해결)<br>
            <strong>2. 보안이 취약합니다:</strong> 모든 것이 하나의 서버에 있어서 공격에 취약합니다 (→ Chapter 08~09에서 해결)<br>
            <strong>3. 확장이 어렵습니다:</strong> 트래픽이 늘면 이 서버 하나로는 감당이 안 됩니다 (→ Chapter 11~12에서 해결)<br>
            <strong>4. 데이터 백업이 없습니다:</strong> 서버가 죽으면 데이터도 사라집니다 (→ Chapter 13~15에서 해결)<br><br>
            이후 챕터에서 이 문제들을 하나씩 해결해 나갑니다!
          </p>
        </div>
      </div>
    </section>

    <!-- Navigation -->
    <div class="chapter-nav">
      <a href="05-ec2-api-deploy.html" class="prev">이전: EC2 기초 & API 서버 배포</a>
      <a href="07-elastic-ip-cost.html" class="next">다음: 탄력적 IP & 비용 관리</a>
    </div>
  </main>
</div>

<script src="../assets/js/main.js"></script>
</body>

</html>
