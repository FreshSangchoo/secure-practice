<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CloudFront - AWS 기초 강의</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>

<header class="site-header">
  <div class="header-inner">
    <a href="../index.html" class="header-logo">
      <span class="aws-icon">AWS</span>
      <span>기초 강의</span>
    </a>
  </div>
</header>

<div class="page-layout">
  <nav class="sidebar">
    <ul class="sidebar-nav">
      <li class="sidebar-section">CDN & 서버리스</li>
      <li><a href="#cdn-concept">CDN이란?</a></li>
      <li><a href="#cloudfront-concepts">CloudFront 핵심 개념</a></li>
      <li><a href="#oac">OAC (Origin Access Control)</a></li>
      <li><a href="#multi-origin">다중 오리진과 비헤이비어</a></li>
      <li><a href="#cache-policy">캐시 정책</a></li>
      <li><a href="#lab">실습</a></li>
    </ul>
  </nav>

  <main class="main-content">
    <div class="chapter-header">
      <span class="chapter-num">Chapter 19</span>
      <h1>CloudFront</h1>
      <div class="objectives">
        <h3>학습 목표</h3>
        <ul>
          <li>CDN(Content Delivery Network)의 개념과 필요성을 이해한다</li>
          <li>CloudFront의 핵심 개념(배포, 오리진, 엣지 로케이션, 캐시 정책)을 설명할 수 있다</li>
          <li>OAC를 사용하여 S3 버킷을 CloudFront를 통해서만 접근하도록 설정할 수 있다</li>
          <li>다중 오리진과 비헤이비어를 설정하여 프론트엔드(S3)와 API(ALB)를 하나의 도메인으로 서비스할 수 있다</li>
          <li>ShopEasy 이커머스 앱을 CloudFront를 통해 배포할 수 있다</li>
        </ul>
      </div>
    </div>

    <!-- Section 1: CDN이란? -->
    <section class="content-section" id="cdn-concept">
      <h2>CDN이란?</h2>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 전국 편의점 네트워크</div>
        <p>여러분이 서울에 사는 친구에게 선물을 보낸다고 생각해보세요. 부산에서 서울까지 택배를 보내면 하루가 걸립니다. 하지만 만약 전국 곳곳에 편의점이 있고, 그 편의점에 미리 같은 물건을 갖다놔둔다면? 서울 친구는 가까운 편의점에서 바로 받을 수 있겠죠!</p>
        <p><strong>CDN도 같은 원리입니다.</strong> 원본 서버(서울 본사)에서 매번 콘텐츠를 가져오는 대신, 전 세계 곳곳에 있는 캐시 서버(편의점)에 콘텐츠를 미리 복사해두고, 사용자와 가장 가까운 서버에서 제공합니다.</p>
      </div>

      <h3>CDN이 없을 때의 문제</h3>
      <p>현재 우리 ShopEasy 쇼핑몰의 상황을 생각해봅시다. S3에 프론트엔드를 호스팅하고 있지만, S3 버킷은 특정 리전(예: 서울)에만 존재합니다.</p>
      <ul>
        <li><strong>멀리 있는 사용자</strong> - 미국이나 유럽에서 접속하면 서울까지 왕복해야 하므로 느립니다</li>
        <li><strong>트래픽 집중</strong> - 모든 요청이 하나의 S3 버킷으로 몰립니다</li>
        <li><strong>보안 취약</strong> - S3 버킷이 직접 인터넷에 노출되어 있습니다</li>
        <li><strong>HTTPS 미지원</strong> - S3 정적 호스팅은 자체 도메인에 대한 HTTPS를 지원하지 않습니다</li>
      </ul>

      <h3>CDN이 해결하는 것들</h3>
      <table>
        <thead>
          <tr><th>문제</th><th>CDN 해결 방법</th></tr>
        </thead>
        <tbody>
          <tr><td>느린 응답 속도</td><td>전 세계 엣지 서버에서 콘텐츠 제공 (지연 시간 감소)</td></tr>
          <tr><td>트래픽 집중</td><td>엣지 서버로 트래픽 분산</td></tr>
          <tr><td>보안</td><td>오리진 서버를 직접 노출하지 않음, DDoS 방어</td></tr>
          <tr><td>HTTPS</td><td>무료 SSL/TLS 인증서 제공</td></tr>
        </tbody>
      </table>

      <div class="info-box concept">
        <div class="info-box-title">핵심 개념: CDN (Content Delivery Network)</div>
        <p>CDN은 전 세계에 분산된 서버 네트워크를 통해 웹 콘텐츠를 사용자에게 빠르게 전달하는 시스템입니다. 사용자와 지리적으로 가장 가까운 서버(엣지 로케이션)에서 콘텐츠를 제공하여 지연 시간을 최소화합니다.</p>
      </div>
    </section>

    <!-- Section 2: CloudFront 핵심 개념 -->
    <section class="content-section" id="cloudfront-concepts">
      <h2>CloudFront 핵심 개념</h2>

      <p>Amazon CloudFront는 AWS에서 제공하는 CDN 서비스입니다. 전 세계 400개 이상의 엣지 로케이션을 통해 콘텐츠를 빠르게 전달합니다.</p>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 프랜차이즈 커피숍</div>
        <p>CloudFront를 프랜차이즈 커피숍이라고 생각해보세요:</p>
        <ul>
          <li><strong>배포(Distribution)</strong> = 프랜차이즈 본부. 어떤 메뉴를 어떤 매장에서 팔지 결정</li>
          <li><strong>오리진(Origin)</strong> = 중앙 공장. 원본 재료를 만드는 곳 (S3, ALB 등)</li>
          <li><strong>엣지 로케이션(Edge Location)</strong> = 동네 매장. 고객과 가까운 곳에서 서비스</li>
          <li><strong>캐시 정책(Cache Policy)</strong> = 매장 재고 관리 규칙. 얼마나 자주 신선한 재료를 가져올지</li>
        </ul>
      </div>

      <h3>배포 (Distribution)</h3>
      <p>CloudFront에서 가장 기본적인 단위입니다. 배포를 생성하면 <code>d1234abcdef.cloudfront.net</code> 같은 도메인 이름이 부여됩니다. 이 도메인으로 접속하면 CloudFront가 콘텐츠를 제공합니다.</p>

      <h3>오리진 (Origin)</h3>
      <p>CloudFront가 원본 콘텐츠를 가져오는 출처입니다. 다양한 AWS 서비스를 오리진으로 설정할 수 있습니다:</p>
      <ul>
        <li><strong>S3 버킷</strong> - 정적 파일 (HTML, CSS, JS, 이미지)</li>
        <li><strong>ALB (Application Load Balancer)</strong> - 동적 API 요청</li>
        <li><strong>EC2 인스턴스</strong> - 직접 서버</li>
        <li><strong>외부 HTTP 서버</strong> - AWS 외부의 서버도 가능</li>
      </ul>

      <h3>엣지 로케이션 (Edge Location)</h3>
      <p>전 세계에 분산된 CloudFront의 캐시 서버입니다. 한국에도 서울과 부산에 엣지 로케이션이 있습니다. 사용자의 요청은 자동으로 가장 가까운 엣지 로케이션으로 라우팅됩니다.</p>

      <div class="diagram">
        <div class="diagram-title">CloudFront 요청 흐름</div>
        <div class="diagram-row">
          <div class="diagram-col">
            <div class="diagram-box user"><div class="box-title">사용자 (부산)</div></div>
            <div class="diagram-box user"><div class="box-title">사용자 (도쿄)</div></div>
          </div>
          <div class="diagram-arrow">&rarr;</div>
          <div class="diagram-col">
            <div class="diagram-box cdn"><div class="box-title">부산 엣지 로케이션</div></div>
            <div class="diagram-box cdn"><div class="box-title">도쿄 엣지 로케이션</div></div>
          </div>
          <div class="diagram-arrow">&rarr;</div>
          <div class="diagram-box storage"><div class="box-title">오리진</div><div class="box-sub">서울 S3/ALB</div></div>
        </div>
        <div style="margin-top:1rem; padding:0.75rem 1rem; background:#f8f9fa; border-radius:8px; font-size:0.92em; line-height:1.8;">
          <strong>[요청 흐름]</strong><br>
          1. 사용자가 CloudFront URL 접속<br>
          2. 가장 가까운 엣지 로케이션으로 라우팅<br>
          3. 캐시에 있으면 &rarr; 바로 응답 (Cache Hit)<br>
          4. 캐시에 없으면 &rarr; 오리진에서 가져옴 &rarr; 캐시 저장 &rarr; 응답 (Cache Miss)
        </div>
      </div>

      <h3>비헤이비어 (Behavior)</h3>
      <p>URL 패턴에 따라 어떤 오리진으로 요청을 보낼지, 어떤 캐시 정책을 적용할지 결정하는 규칙입니다. 하나의 배포에 여러 비헤이비어를 설정할 수 있습니다.</p>

      <div class="info-box tip">
        <div class="info-box-title">Tip: 비헤이비어의 우선순위</div>
        <p>비헤이비어는 위에서 아래 순서로 매칭됩니다. 가장 구체적인 패턴을 위에, 기본 패턴(*)을 아래에 배치합니다. 예: <code>/api/*</code>를 먼저, <code>*</code>(기본)을 나중에 설정합니다.</p>
      </div>
    </section>

    <!-- Section 3: OAC -->
    <section class="content-section" id="oac">
      <h2>OAC (Origin Access Control)</h2>

      <div class="info-box analogy">
        <div class="info-box-title">비유: VIP 전용 입구</div>
        <p>백화점 명품 매장을 생각해보세요. 고객이 직접 창고에 가서 물건을 가져가면 안 되겠죠? 반드시 매장 직원(CloudFront)을 통해서만 상품을 받을 수 있습니다. OAC는 "이 직원만 창고에 들어갈 수 있다"는 출입 카드 같은 것입니다.</p>
      </div>

      <h3>왜 OAC가 필요한가?</h3>
      <p>이전 챕터에서 S3 정적 호스팅을 설정할 때 S3 버킷을 퍼블릭으로 열었습니다. 하지만 이제 CloudFront를 사용하므로:</p>
      <ul>
        <li>사용자가 S3 URL로 직접 접근하면 안 됩니다 (CloudFront의 캐시와 보안을 우회하게 됨)</li>
        <li>S3 버킷은 CloudFront만 접근할 수 있어야 합니다</li>
        <li>OAC를 설정하면 CloudFront가 특별한 인증 정보를 사용하여 S3에 접근합니다</li>
      </ul>

      <h3>OAC vs OAI (이전 방식)</h3>
      <table>
        <thead>
          <tr><th>항목</th><th>OAI (이전)</th><th>OAC (현재 권장)</th></tr>
        </thead>
        <tbody>
          <tr><td>보안 방식</td><td>CloudFront 전용 특수 사용자</td><td>IAM 서비스 주체 기반 서명</td></tr>
          <tr><td>SSE-KMS 지원</td><td>미지원</td><td>지원</td></tr>
          <tr><td>동적 요청</td><td>제한적</td><td>POST/PUT 등 지원</td></tr>
          <tr><td>AWS 권장</td><td>레거시</td><td>권장</td></tr>
        </tbody>
      </table>

      <div class="info-box warning">
        <div class="info-box-title">참고: OAC 설정 시 S3 버킷 정책 변경 필수</div>
        <p>OAC를 설정한 후에는 S3 버킷 정책을 업데이트하여 CloudFront 배포에서만 접근을 허용해야 합니다. 이전의 퍼블릭 접근 정책은 제거합니다.</p>
      </div>
    </section>

    <!-- Section 4: 다중 오리진과 비헤이비어 -->
    <section class="content-section" id="multi-origin">
      <h2>다중 오리진과 비헤이비어</h2>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 백화점 안내데스크</div>
        <p>백화점 안내데스크에서 "화장품은 1층, 식당은 6층"이라고 안내하는 것처럼, CloudFront도 URL 경로에 따라 다른 오리진으로 안내합니다. <code>/api/*</code>로 시작하는 요청은 ALB(API 서버)로, 나머지는 S3(프론트엔드)로 보냅니다.</p>
      </div>

      <p>우리 ShopEasy 이커머스 앱은 두 가지 오리진이 필요합니다:</p>

      <div class="diagram">
        <div class="diagram-title">다중 오리진과 비헤이비어</div>
        <div class="diagram-row">
          <div class="diagram-box cdn"><div class="box-title">CloudFront</div><div class="box-sub">xxx.cloudfront.net</div></div>
        </div>
        <div class="diagram-arrow down">&darr;</div>
        <div class="diagram-row">
          <div class="diagram-box network"><div class="box-title">비헤이비어 규칙</div></div>
        </div>
        <div class="diagram-row" style="margin-top:0.5rem;">
          <div class="diagram-col" style="flex:1; align-items:center;">
            <div style="font-weight:600; margin-bottom:0.5rem;">/api/* 요청</div>
            <div class="diagram-arrow down">&darr;</div>
            <div class="diagram-box network"><div class="box-title">오리진 2: ALB</div><div class="box-sub">API 서버</div></div>
          </div>
          <div class="diagram-col" style="flex:1; align-items:center;">
            <div style="font-weight:600; margin-bottom:0.5rem;">/* 기본 요청</div>
            <div class="diagram-arrow down">&darr;</div>
            <div class="diagram-box storage"><div class="box-title">오리진 1: S3 버킷</div><div class="box-sub">React 프론트엔드</div></div>
          </div>
        </div>
      </div>

      <h3>비헤이비어 설정 예시</h3>
      <table>
        <thead>
          <tr><th>경로 패턴</th><th>오리진</th><th>캐시 정책</th><th>설명</th></tr>
        </thead>
        <tbody>
          <tr><td><code>/api/*</code></td><td>ALB</td><td>캐싱 비활성화</td><td>API 요청은 항상 서버에 전달</td></tr>
          <tr><td><code>*</code> (기본)</td><td>S3</td><td>캐싱 활성화 (24시간)</td><td>정적 파일은 캐시에서 제공</td></tr>
        </tbody>
      </table>

      <div class="info-box concept">
        <div class="info-box-title">핵심: 하나의 도메인으로 통합</div>
        <p>다중 오리진 설정의 가장 큰 장점은 <strong>프론트엔드와 API를 하나의 도메인</strong>으로 서비스할 수 있다는 것입니다. 이렇게 하면 CORS 문제가 사라지고, 쿠키 공유가 쉬워지며, 사용자 입장에서도 하나의 URL만 기억하면 됩니다.</p>
      </div>
    </section>

    <!-- Section 5: 캐시 정책 -->
    <section class="content-section" id="cache-policy">
      <h2>캐시 정책</h2>

      <div class="info-box analogy">
        <div class="info-box-title">비유: 편의점 재고 관리</div>
        <p>편의점에서 삼각김밥의 유통기한은 짧고(TTL 짧음), 라면은 오래갑니다(TTL 김). 마찬가지로 자주 바뀌는 API 응답은 캐시를 짧게, 잘 안 바뀌는 이미지나 CSS는 캐시를 길게 설정합니다.</p>
      </div>

      <h3>캐시 정책이란?</h3>
      <p>CloudFront가 오리진에서 가져온 콘텐츠를 얼마나 오래 캐시할지, 어떤 기준으로 캐시를 구분할지 결정하는 규칙입니다.</p>

      <h3>주요 설정 항목</h3>
      <ul>
        <li><strong>TTL (Time To Live)</strong> - 캐시 유지 시간. 최소 TTL, 기본 TTL, 최대 TTL을 설정</li>
        <li><strong>캐시 키</strong> - 무엇을 기준으로 캐시를 구분할지 (헤더, 쿠키, 쿼리 문자열)</li>
        <li><strong>압축</strong> - Gzip, Brotli 압축 지원 여부</li>
      </ul>

      <h3>AWS 관리형 캐시 정책</h3>
      <p>AWS에서 미리 만들어둔 캐시 정책을 사용할 수 있어 편리합니다:</p>
      <table>
        <thead>
          <tr><th>정책 이름</th><th>용도</th><th>특징</th></tr>
        </thead>
        <tbody>
          <tr><td><code>CachingOptimized</code></td><td>정적 콘텐츠</td><td>기본 TTL 24시간, Gzip/Brotli 압축</td></tr>
          <tr><td><code>CachingDisabled</code></td><td>API 요청</td><td>캐싱 안 함, 항상 오리진에 전달</td></tr>
          <tr><td><code>CachingOptimizedForUncompressedObjects</code></td><td>이미 압축된 콘텐츠</td><td>압축 미적용</td></tr>
        </tbody>
      </table>

      <div class="info-box tip">
        <div class="info-box-title">Tip: API 요청은 캐싱하지 마세요</div>
        <p>API 서버(<code>/api/*</code>)로 가는 요청은 반드시 <code>CachingDisabled</code> 정책을 사용해야 합니다. 상품 주문이나 장바구니 변경 같은 동적 데이터를 캐싱하면 사용자가 이전 데이터를 보게 됩니다.</p>
      </div>

      <h3>캐시 무효화 (Invalidation)</h3>
      <p>프론트엔드를 업데이트했는데 사용자에게 이전 버전이 보인다면? 캐시 무효화를 실행하여 캐시를 강제로 삭제할 수 있습니다.</p>
      <div class="code-block">
        <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
        <pre><code># 모든 파일 캐시 무효화
aws cloudfront create-invalidation --distribution-id E1234567890 --paths "/*"

# 특정 파일만 무효화
aws cloudfront create-invalidation --distribution-id E1234567890 --paths "/index.html" "/static/js/*"</code></pre>
      </div>

      <div class="info-box warning">
        <div class="info-box-title">비용 주의: 캐시 무효화</div>
        <p>매월 처음 1,000개의 무효화 경로는 무료이지만, 이후에는 경로당 비용이 발생합니다. 배포할 때마다 <code>/*</code>로 전체 무효화하는 것보다 변경된 파일만 무효화하는 것이 좋습니다.</p>
      </div>
    </section>

    <!-- Lab Section -->
    <section class="content-section" id="lab">
      <h2>실습</h2>

      <div class="info-box danger">
        <div class="info-box-title">비용 안내</div>
        <p>CloudFront는 프리티어에서 매월 1TB의 데이터 전송, 10,000,000건의 HTTP/HTTPS 요청이 무료입니다(첫 12개월). 실습 범위에서는 비용이 발생하지 않지만, 실습 후 불필요한 배포는 삭제하세요.</p>
      </div>

      <div class="lab-section">
        <div class="lab-title">실습: ShopEasy에 CloudFront 적용하기</div>
        <ol class="steps">

          <!-- Step 1 -->
          <li class="step">
            <div class="step-title">CloudFront 배포 생성 시작</div>
            <p>AWS 콘솔에서 CloudFront 서비스로 이동합니다.</p>
            <p><strong>서비스 검색창</strong>에 <code>CloudFront</code>를 입력하고 선택합니다.</p>
            <p><strong>배포 생성(Create Distribution)</strong> 버튼을 클릭합니다.</p>
            <div class="screenshot-placeholder">CloudFront 콘솔 메인 화면 - 배포 생성 버튼</div>
          </li>

          <!-- Step 2 -->
          <li class="step">
            <div class="step-title">오리진 1 설정: S3 버킷 (프론트엔드)</div>
            <p>첫 번째 오리진으로 S3 버킷을 설정합니다. 이것이 기본(Default) 오리진이 됩니다.</p>
            <p><strong>Origin domain</strong>에서 S3 버킷을 선택합니다:</p>
            <ul>
              <li>드롭다운에서 <code>shopeasy-frontend-[계정ID].s3.ap-northeast-2.amazonaws.com</code> 선택</li>
              <li><strong>주의:</strong> "S3 website endpoint 사용"이 아닌, S3 REST API 엔드포인트를 선택합니다</li>
            </ul>
            <p><strong>Origin access</strong> 설정:</p>
            <ul>
              <li><strong>Origin access control settings (recommended)</strong> 선택</li>
              <li><strong>Create new OAC</strong> 버튼 클릭</li>
              <li>이름: <code>shopeasy-frontend-oac</code></li>
              <li>Signing behavior: <strong>Sign requests (recommended)</strong> 선택</li>
              <li><strong>Create</strong> 클릭</li>
            </ul>
            <div class="screenshot-placeholder">오리진 설정 - S3 버킷 선택 및 OAC 생성 화면</div>

            <div class="info-box warning">
              <div class="info-box-title">중요: S3 버킷 정책 업데이트 안내</div>
              <p>OAC를 생성하면 상단에 노란색 배너가 나타나면서 "S3 버킷 정책을 업데이트해야 합니다"라는 안내가 표시됩니다. 배포 생성 후에 업데이트할 것이므로, 지금은 일단 넘어갑니다.</p>
            </div>
          </li>

          <!-- Step 3 -->
          <li class="step">
            <div class="step-title">기본 캐시 비헤이비어 설정</div>
            <p>기본 캐시 비헤이비어(Default cache behavior)를 설정합니다. 이 설정은 S3 오리진(프론트엔드)에 적용됩니다.</p>
            <ul>
              <li><strong>Viewer protocol policy</strong>: <code>Redirect HTTP to HTTPS</code> (HTTP 접속 시 자동으로 HTTPS로 리다이렉트)</li>
              <li><strong>Allowed HTTP methods</strong>: <code>GET, HEAD</code> (정적 파일이므로 GET만 필요)</li>
              <li><strong>Cache policy</strong>: <code>CachingOptimized</code> 선택 (정적 파일에 최적화된 캐싱)</li>
            </ul>
            <div class="screenshot-placeholder">기본 캐시 비헤이비어 설정 화면</div>
          </li>

          <!-- Step 4 -->
          <li class="step">
            <div class="step-title">WAF 및 기타 설정</div>
            <p>나머지 설정을 완료합니다.</p>
            <ul>
              <li><strong>Web Application Firewall (WAF)</strong>: <code>Do not enable security protections</code> 선택 (실습에서는 비용 절약)</li>
              <li><strong>Price class</strong>: <code>Use only North America and Europe</code> 또는 <code>Use all edge locations</code> (프리티어이므로 무관)</li>
              <li><strong>Default root object</strong>: <code>index.html</code> 입력 (매우 중요! 루트 접속 시 보여줄 파일)</li>
              <li><strong>Description</strong>: <code>ShopEasy E-commerce CloudFront Distribution</code></li>
            </ul>
            <p><strong>배포 생성(Create distribution)</strong> 버튼을 클릭합니다.</p>
            <div class="screenshot-placeholder">WAF 및 기타 설정 화면</div>

            <div class="info-box warning">
              <div class="info-box-title">배포 생성 시간</div>
              <p>CloudFront 배포가 생성되는 데 5~10분 정도 걸립니다. 상태가 "Deploying"에서 "Enabled"로 바뀔 때까지 기다립니다. 기다리는 동안 다음 단계를 진행할 수 있습니다.</p>
            </div>
          </li>

          <!-- Step 5 -->
          <li class="step">
            <div class="step-title">S3 버킷 정책 업데이트 (CloudFront만 접근 허용)</div>
            <p>배포 생성 후 나타나는 상단 배너에서 <strong>Copy policy</strong>를 클릭하여 버킷 정책을 복사합니다.</p>
            <p>또는 아래 정책을 직접 작성합니다. <code>[배포ID]</code>와 <code>[버킷이름]</code>을 본인의 값으로 변경하세요:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">json</span><button class="copy-btn">복사</button></div>
              <pre><code>{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowCloudFrontServicePrincipal",
            "Effect": "Allow",
            "Principal": {
                "Service": "cloudfront.amazonaws.com"
            },
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::shopeasy-frontend-[계정ID]/*",
            "Condition": {
                "StringEquals": {
                    "AWS:SourceArn": "arn:aws:cloudfront::[계정ID]:distribution/[배포ID]"
                }
            }
        }
    ]
}</code></pre>
            </div>
            <p>S3 콘솔로 이동하여 프론트엔드 버킷의 <strong>권한(Permissions)</strong> 탭 > <strong>버킷 정책(Bucket policy)</strong>에 위 정책을 붙여넣고 저장합니다.</p>
            <p>기존의 퍼블릭 접근 정책이 있다면 위 정책으로 <strong>교체</strong>합니다 (이전 퍼블릭 정책 삭제).</p>
            <div class="screenshot-placeholder">S3 버킷 정책 편집 화면</div>

            <div class="info-box tip">
              <div class="info-box-title">Tip: 퍼블릭 접근 차단 활성화</div>
              <p>OAC를 통해서만 접근하므로, S3 버킷의 "Block all public access"를 다시 활성화해도 됩니다. CloudFront는 OAC를 사용하여 S3에 접근하므로 퍼블릭 접근이 필요 없습니다.</p>
            </div>
          </li>

          <!-- Step 6 -->
          <li class="step">
            <div class="step-title">오리진 2 추가: ALB (API 서버)</div>
            <p>CloudFront 배포의 <strong>Origins</strong> 탭에서 <strong>Create origin</strong>을 클릭합니다.</p>
            <ul>
              <li><strong>Origin domain</strong>: ALB의 DNS 이름을 입력합니다 (예: <code>shopeasy-alb-1234567890.ap-northeast-2.elb.amazonaws.com</code>)</li>
              <li><strong>Protocol</strong>: <code>HTTP only</code> (ALB와 CloudFront 사이는 HTTP)</li>
              <li><strong>HTTP port</strong>: <code>80</code></li>
              <li><strong>Name</strong>: <code>shopeasy-alb-origin</code></li>
            </ul>
            <p><strong>Create origin</strong>을 클릭합니다.</p>
            <div class="screenshot-placeholder">ALB 오리진 추가 설정 화면</div>
          </li>

          <!-- Step 7 -->
          <li class="step">
            <div class="step-title">비헤이비어 설정: /api/* -> ALB</div>
            <p><strong>Behaviors</strong> 탭에서 <strong>Create behavior</strong>를 클릭합니다.</p>
            <ul>
              <li><strong>Path pattern</strong>: <code>/api/*</code></li>
              <li><strong>Origin and origin groups</strong>: 방금 추가한 ALB 오리진 선택</li>
              <li><strong>Viewer protocol policy</strong>: <code>Redirect HTTP to HTTPS</code></li>
              <li><strong>Allowed HTTP methods</strong>: <code>GET, HEAD, OPTIONS, PUT, POST, PATCH, DELETE</code> (API는 모든 HTTP 메서드 필요)</li>
              <li><strong>Cache policy</strong>: <code>CachingDisabled</code> (API 요청은 캐싱하지 않음)</li>
              <li><strong>Origin request policy</strong>: <code>AllViewer</code> (모든 헤더를 오리진에 전달)</li>
            </ul>
            <p><strong>Create behavior</strong>를 클릭합니다.</p>
            <div class="screenshot-placeholder">API 비헤이비어 생성 화면</div>

            <div class="info-box concept">
              <div class="info-box-title">비헤이비어 순서 확인</div>
              <p>Behaviors 탭에서 순서를 확인합니다. <code>/api/*</code>가 Default(*)보다 위에 있어야 합니다. CloudFront는 위에서 아래로 패턴을 매칭하며, 먼저 매칭되는 규칙을 적용합니다.</p>
            </div>
          </li>

          <!-- Step 8 -->
          <li class="step">
            <div class="step-title">배포 완료 확인 및 CloudFront URL로 접속</div>
            <p>배포 상태가 <strong>Enabled</strong>로 변경되었는지 확인합니다.</p>
            <p>배포의 <strong>Distribution domain name</strong>을 복사합니다 (예: <code>d1234abcdef.cloudfront.net</code>).</p>
            <p>브라우저에서 CloudFront URL로 접속합니다:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">url</span><button class="copy-btn">복사</button></div>
              <pre><code>https://d1234abcdef.cloudfront.net</code></pre>
            </div>
            <p>ShopEasy 쇼핑몰이 정상적으로 표시되는지 확인합니다.</p>
            <div class="screenshot-placeholder">CloudFront URL로 접속한 ShopEasy 메인 화면</div>
          </li>

          <!-- Step 9 -->
          <li class="step">
            <div class="step-title">프론트엔드 API URL 업데이트</div>
            <p>프론트엔드 코드에서 API 요청 URL을 CloudFront URL로 변경해야 합니다.</p>
            <p>로컬에서 <code>.env</code> 파일 또는 API 설정 파일을 수정합니다:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">env</span><button class="copy-btn">복사</button></div>
              <pre><code># 변경 전
REACT_APP_API_URL=http://shopeasy-alb-xxx.ap-northeast-2.elb.amazonaws.com/api

# 변경 후 (CloudFront URL 사용)
REACT_APP_API_URL=https://d1234abcdef.cloudfront.net/api</code></pre>
            </div>
            <p>프론트엔드를 다시 빌드하고 S3에 업로드합니다:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 프론트엔드 빌드
cd frontend
npm run build

# S3에 업로드
aws s3 sync build/ s3://shopeasy-frontend-[계정ID] --delete

# CloudFront 캐시 무효화
aws cloudfront create-invalidation --distribution-id [배포ID] --paths "/*"</code></pre>
            </div>
          </li>

          <!-- Step 10 -->
          <li class="step">
            <div class="step-title">전체 기능 테스트</div>
            <p>CloudFront URL(<code>https://d1234abcdef.cloudfront.net</code>)에서 모든 기능이 정상 동작하는지 확인합니다:</p>
            <ul>
              <li><strong>메인 페이지</strong> - 프론트엔드가 정상 로딩되는지</li>
              <li><strong>상품 목록</strong> - API를 통해 상품 데이터가 표시되는지</li>
              <li><strong>상품 상세</strong> - 상품 이미지가 정상 표시되는지</li>
              <li><strong>리뷰 조회</strong> - DynamoDB에서 리뷰 데이터가 표시되는지</li>
              <li><strong>리뷰 사진</strong> - S3에 저장된 리뷰 사진이 정상 표시되는지</li>
              <li><strong>주문하기</strong> - API를 통한 주문이 정상 처리되는지</li>
            </ul>
            <div class="screenshot-placeholder">전체 기능 테스트 - 상품 목록, 리뷰, 주문이 모두 동작하는 화면</div>

            <div class="info-box tip">
              <div class="info-box-title">Tip: 브라우저 개발자 도구로 확인</div>
              <p>F12를 눌러 개발자 도구를 열고, Network 탭에서 요청들을 확인합니다. <code>x-cache: Hit from cloudfront</code> 헤더가 보이면 캐시에서 제공된 것이고, <code>x-cache: Miss from cloudfront</code>이면 오리진에서 가져온 것입니다. 같은 페이지를 새로고침하면 Hit로 바뀌는 것을 확인할 수 있습니다.</p>
            </div>
          </li>

          <!-- Step 11 -->
          <li class="step">
            <div class="step-title">캐시 동작 확인</div>
            <p>CloudFront의 캐시가 잘 동작하는지 CLI로 확인합니다:</p>
            <div class="code-block">
              <div class="code-header"><span class="lang">bash</span><button class="copy-btn">복사</button></div>
              <pre><code># 첫 번째 요청 (Cache Miss)
curl -I https://d1234abcdef.cloudfront.net/index.html

# 응답 헤더 확인:
# x-cache: Miss from cloudfront  (오리진에서 가져옴)

# 두 번째 요청 (Cache Hit)
curl -I https://d1234abcdef.cloudfront.net/index.html

# 응답 헤더 확인:
# x-cache: Hit from cloudfront  (캐시에서 제공)</code></pre>
            </div>
          </li>

        </ol>
      </div>

      <div class="info-box concept">
        <div class="info-box-title">현재 아키텍처 요약</div>
        <p>이제 우리 ShopEasy 이커머스 앱의 전체 아키텍처는 다음과 같습니다:</p>
      </div>

      <div class="diagram">
        <div class="diagram-title">현재 아키텍처</div>
        <div class="diagram-row">
          <div class="diagram-box user"><div class="box-title">사용자</div></div>
        </div>
        <div class="diagram-arrow down">&darr;</div>
        <div class="diagram-row">
          <div class="diagram-box cdn"><div class="box-title">CloudFront (CDN)</div><div class="box-sub">d1234abcdef.cloudfront.net</div></div>
        </div>
        <div class="diagram-row" style="margin-top:0.5rem;">
          <div class="diagram-col" style="flex:1; align-items:center;">
            <div style="font-weight:600; margin-bottom:0.5rem;">/* (정적 파일)</div>
            <div class="diagram-arrow down">&darr;</div>
            <div class="diagram-box storage"><div class="box-title">S3 버킷</div><div class="box-sub">React 프론트엔드<br>[OAC로 보호]</div></div>
          </div>
          <div class="diagram-col" style="flex:1; align-items:center;">
            <div style="font-weight:600; margin-bottom:0.5rem;">/api/* (API)</div>
            <div class="diagram-arrow down">&darr;</div>
            <div class="diagram-box network"><div class="box-title">ALB</div></div>
            <div class="diagram-arrow down">&darr;</div>
            <div class="diagram-box compute"><div class="box-title">Auto Scaling Group</div><div class="box-sub">EC2 (API 서버 1)<br>EC2 (API 서버 2)</div></div>
            <div class="diagram-arrow down">&darr;</div>
            <div class="diagram-row">
              <div class="diagram-box database"><div class="box-title">RDS MySQL</div><div class="box-sub">상품/주문</div></div>
              <div class="diagram-box database"><div class="box-title">DynamoDB</div><div class="box-sub">리뷰</div></div>
              <div class="diagram-box storage"><div class="box-title">S3</div><div class="box-sub">리뷰 사진</div></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="chapter-nav">
      <a href="18-s3-static-hosting.html" class="prev">이전: S3 정적 호스팅 & 프론트엔드 이전</a>
      <a href="20-lambda-basics.html" class="next">다음: Lambda 기초</a>
    </div>
  </main>
</div>

<script src="../assets/js/main.js"></script>
</body>

</html>
